# talm: nodes=["192.168.1.41"], endpoints=["192.168.1.41"], templates=["templates/controlplane.yaml"]
# THIS FILE IS AUTOGENERATED. PREFER TEMPLATE EDITS OVER MANUAL ONES.
machine:
  type: controlplane
  certSANs:
    - 127.0.0.1
  kubelet:
    extraConfig:
      cpuManagerPolicy: static
      maxPods: 512
    nodeIP:
      validSubnets:
        - 10.50.50.0/24
  network:
    hostname: the-dome
    # -- Discovered interfaces:
    # eno1:
    #   hardwareAddr:60:cf:84:ab:35:97
    #   busPath: 0000:0a:00.0
    #   driver: r8169
    #   vendor: Realtek Semiconductor Co., Ltd.
    #   product: RTL8125 2.5GbE Controller)
    # enp4s0f0np0:
    #   hardwareAddr:e8:eb:d3:2a:b8:8a
    #   busPath: 0000:04:00.0
    #   driver: mlx5_core
    #   vendor: Mellanox Technologies
    #   product: MT27710 Family [ConnectX-4 Lx])
    # enp4s0f1np1:
    #   hardwareAddr:e8:eb:d3:2a:b8:8b
    #   busPath: 0000:04:00.1
    #   driver: mlx5_core
    #   vendor: Mellanox Technologies
    #   product: MT27710 Family [ConnectX-4 Lx])
    # enp6s0:
    #   hardwareAddr:bc:07:1d:dd:64:54
    #   busPath: 0000:06:00.0
    #   driver: r8169
    #   vendor: Realtek Semiconductor Co., Ltd.
    #   product: RTL8125 2.5GbE Controller)
    interfaces:
      - interface: br0
        addresses:
          - 10.50.50.11/24
        bridge:
          interfaces:
            - enp4s0f0np0
            - enp4s0f1np1
          stp:
            enabled: true
      - interface: eno1
        vlans:
          - addresses:
              - 192.168.50.11/24
            routes:
              - network: 0.0.0.0/0
                gateway: 192.168.50.1
            dhcp: false
            vlanId: 50
        vip:
          ip: 192.168.50.50
      - interface: enp6s0
        ignore: true
    nameservers:
      - 192.168.50.1
  install:
    # -- Discovered disks:
    # /dev/nvme0n1:
    #    model: Patriot M.2 P300 128GB
    #    serial: P300ZDBB24112203332
    #    wwid: nvme.1e4b-503330305a4442423234313132323033333332-50617472696f74204d2e322050333030203132384742-00000001
    #    size: 128 GB
    # /dev/nvme1n1:
    #    model: Micron_7400_MTFDKCC1T9TDZ
    #    serial: 223249F0F8D4
    #    wwid: eui.000000000000000100a0752249f0f8d4
    #    size: 1.9 TB
    disk: /dev/nvme0n1
    image: ghcr.io/cozystack/cozystack/talos:v1.10.5
  files:
    - content: |
        [plugins]
          [plugins."io.containerd.grpc.v1.cri"]
            device_ownership_from_security_context = true
          [plugins."io.containerd.cri.v1.runtime"]
            device_ownership_from_security_context = true
      permissions: 0o0
      path: /etc/cri/conf.d/20-customization.part
      op: create
  sysctls:
    net.ipv4.neigh.default.gc_thresh1: "4096"
    net.ipv4.neigh.default.gc_thresh2: "8192"
    net.ipv4.neigh.default.gc_thresh3: "16384"
  registries:
    mirrors:
      docker.io:
        endpoints:
          - https://mirror.gcr.io
  kernel:
    modules:
      - name: openvswitch
      - name: drbd
        parameters:
          - usermode_helper=disabled
      - name: zfs
      - name: spl
      - name: vfio_pci
      - name: vfio_iommu_type1
  nodeLabels:
    node.kubernetes.io/exclude-from-external-load-balancers:
      $patch: delete
cluster:
  controlPlane:
    endpoint: https://192.168.100.10:6443
  clusterName: enigma-cozy
  network:
    cni:
      name: none
    dnsDomain: cozy.local
    serviceSubnets:
      - 10.96.0.0/16
  apiServer:
    certSANs:
      - 127.0.0.1
  controllerManager:
    extraArgs:
      bind-address: 0.0.0.0
  proxy:
    disabled: true
  scheduler:
    extraArgs:
      bind-address: 0.0.0.0
  discovery:
    enabled: false
  etcd:
    advertisedSubnets:
      - 10.50.50.0/24
  allowSchedulingOnControlPlanes: true
