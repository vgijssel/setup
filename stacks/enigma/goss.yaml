command:
  bridge_cni_installed:
    title: Validate the bridge CNI plugin is installed in Talos
    exec: talosctl ls /opt/cni/bin | grep bridge | sort
    exit-status: 0
    stdout: |
      192.168.1.40   bridge
      192.168.1.41   bridge
      192.168.1.42   bridge
    stderr: ""
    timeout: 10000
  ceph status --format json | jq -r ".health.status":
    title: Ceph must be healthy for the cluster to be functional
    exit-status: 0
    stdout:
      - HEALTH_OK
    stderr: null
    timeout: 10000
  cilium_status:
    title: Cilium must be healthy for the network to be functional
    exec: cilium status --output json | jq ".pod_state"
    exit-status: 0
    stdout: |
      {
        "cilium": {
          "Type": "DaemonSet",
          "Desired": 3,
          "Ready": 3,
          "Available": 3,
          "Unavailable": 0
        },
        "cilium-envoy": {
          "Type": "DaemonSet",
          "Desired": 3,
          "Ready": 3,
          "Available": 3,
          "Unavailable": 0
        },
        "cilium-operator": {
          "Type": "Deployment",
          "Desired": 2,
          "Ready": 2,
          "Available": 2,
          "Unavailable": 0
        },
        "hubble-relay": {
          "Type": "Deployment",
          "Desired": 1,
          "Ready": 1,
          "Available": 1,
          "Unavailable": 0
        },
        "hubble-ui": {
          "Type": "Deployment",
          "Desired": 1,
          "Ready": 1,
          "Available": 1,
          "Unavailable": 0
        }
      }
    stderr: ""
    timeout: 10000
  hubble status:
    exit-status: 0
    stdout:
      - "Healthcheck (via localhost:4245): Ok"
      - "Connected Nodes: 3/3"
    stderr: ""
    timeout: 10000
  kubectl_nodes:
    title: Validate the cluster nodes are healthy
    exec: kubectl get no -o=custom-columns="NAME:.metadata.name,STATUS:.status.conditions[-1].type,OS-IMAGE:.status.nodeInfo.osImage,INTERNAL-IP:.status.addresses[?(@.type==\"InternalIP\")].address,EXTERNAL-IP:.status.addresses[?(@.type==\"ExternalIP\")].address" --sort-by=.metadata.name
    exit-status: 0
    stdout:
      - NAME              STATUS   OS-IMAGE         INTERNAL-IP   EXTERNAL-IP
      - illusion          Ready    Talos (v1.9.5)   10.15.15.42   <none>
      - the-dome          Ready    Talos (v1.9.5)   10.15.15.41   <none>
      - the-toy-factory   Ready    Talos (v1.9.5)   10.15.15.40   <none>
    stderr: ""
    timeout: 10000
http:
  http://192.168.1.90:
    title: Validate the Multus exposed nginx service is reachable though the LAN
    status: 200
    allow-insecure: false
    no-follow-redirects: false
    timeout: 5000
    body: []
