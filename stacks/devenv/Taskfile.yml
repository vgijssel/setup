version: "3"

tasks:
  # TODO: implement basic Ansible playbook to provision the devenv
  apply:
    desc: Apply the development environment configuration
    cmds:
      - helmfile init

  test:
    desc: Test the development environment
    dir: stacks/devenv
    cmds:
      - goss validate

  # TODO: experiment using a shell which sets environment variables when it starts?
  secrets:
    desc: Install secrets for the devenv
    cmds:
      - op inject --force --in-file=.op.env --out-file=.env
    sources:
      - .op.env
