language: javascript
layer: application
tags:
  - type.application
  - scope.home-automation
  - platform.home-assistant
  - type.application
  - scope.home-automation
  - platform.home-assistant
tasks:
  all:
    deps:
      - sync
      - update
      - validate
    options:
      runInCI: false
      runDepsInParallel: false

  sync:
    command: unison haos -ignorearchives
    options:
      interactive: true
      runInCI: false

  update:
    script: 'curl -f -H "Authorization: Bearer $HA_TOKEN" -H "Content-Type: application/json" -X POST -d ''{}'' http://192.168.1.32:8123/api/services/homeassistant/reload_all'
    options:
      runInCI: false

  validate:
    command: goss validate
    options:
      runInCI: false
