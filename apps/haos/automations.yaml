- id: "1754753646691"
  alias: Supply Closet - Turn On Lights
  description: ""
  triggers:
    - type: opened
      device_id: a62de5fe0e35a2d1e908876d86033594
      entity_id: 297272a4570654e5bd288da03d3b9437
      domain: binary_sensor
      trigger: device
  conditions: []
  actions:
    - type: turn_on
      device_id: 302cf0e6ebd333f1e79e8c33d4d4c030
      entity_id: 669044aeb04953856eb2c5fbc68cddbd
      domain: switch
  mode: single
- id: "1754753697773"
  alias: Supply Closet - Turn Off Lights
  description: ""
  triggers:
    - type: not_opened
      device_id: a62de5fe0e35a2d1e908876d86033594
      entity_id: 297272a4570654e5bd288da03d3b9437
      domain: binary_sensor
      trigger: device
  conditions: []
  actions:
    - type: turn_off
      device_id: 302cf0e6ebd333f1e79e8c33d4d4c030
      entity_id: 669044aeb04953856eb2c5fbc68cddbd
      domain: switch
  mode: single
- id: "1754897315049"
  alias: Garden - Start Pump Timer
  description: ""
  triggers:
    - trigger: time
      at: 06:00:00
      weekday:
        - mon
        - tue
        - wed
        - fri
        - sat
        - sun
        - thu
    - trigger: time
      at: "22:00:00"
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
        - sat
        - sun
  conditions:
    - condition: device
      type: is_off
      device_id: 254bd3f4675ebd884cf48e8432ade589
      entity_id: c3c6a841bbf202032bd5ed1a881a54ff
      domain: switch
  actions:
    - action: timer.start
      metadata: {}
      data:
        duration: 01:00:00
      target:
        entity_id: timer.garden_pump_timer
  mode: single
- id: "1754897526643"
  alias: Garden - Start Pump
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - timer.garden_pump_timer
      from:
      to: active
  conditions: []
  actions:
    - type: turn_on
      device_id: 254bd3f4675ebd884cf48e8432ade589
      entity_id: c3c6a841bbf202032bd5ed1a881a54ff
      domain: switch
  mode: single
- id: "1754897648095"
  alias: Garden - Turn Off Pump
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - timer.garden_pump_timer
      to: idle
  conditions: []
  actions:
    - type: turn_off
      device_id: 254bd3f4675ebd884cf48e8432ade589
      entity_id: c3c6a841bbf202032bd5ed1a881a54ff
      domain: switch
  mode: single
- id: "1754921354906"
  alias: Garden - Door Presence
  description: ""
  use_blueprint:
    path: setup/door_presence.yaml
    input:
      contact_sensor: binary_sensor.garden_contact_door
      motion_sensor: binary_sensor.garden_motion_occupancy
      variable_sensor: binary_sensor.garden_door_presence
- id: "1754923333948"
  alias: Hallway - Door Presence
  description: ""
  use_blueprint:
    path: setup/door_presence.yaml
    input:
      contact_sensor: binary_sensor.hallway_contact_door
      motion_sensor: binary_sensor.hallway_motion_occupancy
      variable_sensor: binary_sensor.hallway_door_presence
- id: "1754923400673"
  alias: Living Room - Door Presence
  description: ""
  use_blueprint:
    path: setup/door_presence.yaml
    input:
      contact_sensor: binary_sensor.living_room_contact_door
      motion_sensor: binary_sensor.living_room_motion_occupancy
      variable_sensor: binary_sensor.living_room_door_presence
- id: "1754923474097"
  alias: Toilet - Door Presence
  description: ""
  use_blueprint:
    path: setup/door_presence.yaml
    input:
      contact_sensor: binary_sensor.toilet_contact_door
      motion_sensor: binary_sensor.toilet_motion
      variable_sensor: binary_sensor.toilet_door_presence
- id: "1754924013174"
  alias: Baby Room - Door Presence
  description: ""
  use_blueprint:
    path: setup/door_presence.yaml
    input:
      contact_sensor: binary_sensor.baby_room_contact_door
      motion_sensor: binary_sensor.baby_room_motion_occupancy
      variable_sensor: binary_sensor.baby_room_door_presence
- id: "1754924065570"
  alias: Bedroom - Door Presence
  description: ""
  use_blueprint:
    path: setup/door_presence.yaml
    input:
      contact_sensor: binary_sensor.bedroom_contact_door
      motion_sensor: binary_sensor.bedroom_motion_occupancy
      variable_sensor: binary_sensor.bedroom_door_presence
- id: "1754924108862"
  alias: Office - Door Presence
  description: ""
  use_blueprint:
    path: setup/door_presence.yaml
    input:
      contact_sensor: binary_sensor.office_door_door
      motion_sensor: binary_sensor.office_motion_occupancy
      variable_sensor: binary_sensor.office_door_presence
- id: "1754931182384"
  alias: Living Room - Occupancy
  description: ""
  triggers:
    - trigger: state
      entity_id:
        - binary_sensor.garden_door_presence
        - binary_sensor.living_room_door_presence
      from:
      to:
      id: door
    - trigger: state
      entity_id:
        - input_select.living_room_occupancy_state
      id: select
    - trigger: state
      entity_id:
        - timer.living_room_occupancy_timer
      from:
      to:
      id: timer
    - trigger: state
      entity_id:
        - binary_sensor.living_room_occupancy_presence
      id: occupancy
  conditions: []
  actions:
    - variables:
        doors:
          - binary_sensor.living_room_door_presence
          - binary_sensor.garden_door_presence
        doors_have_activity: "{{ expand(doors) | selectattr('state', 'eq', 'on')
          | list | count > 0 }}"
    - choose:
        - conditions:
            - condition: trigger
              id:
                - select
          sequence:
            - if:
                - condition: state
                  entity_id: input_select.living_room_occupancy_state
                  state:
                    - entering
                    - entering_confirm
                    - leaving
                    - leaving_confirm
              then:
                - action: timer.start
                  metadata: {}
                  data:
                    duration: 00:00:10
                  target:
                    entity_id: timer.living_room_occupancy_timer
        - conditions:
            - condition: state
              entity_id: input_select.living_room_occupancy_state
              state: absent
          sequence:
            - if:
                - condition: template
                  value_template: "{{ doors_have_activity }}"
              then:
                - action: input_select.select_option
                  metadata: {}
                  data:
                    option: entering
                  target:
                    entity_id: input_select.living_room_occupancy_state
        - conditions:
            - condition: state
              entity_id: input_select.living_room_occupancy_state
              state: entering
          sequence:
            - choose:
                - conditions:
                    - condition: state
                      entity_id: binary_sensor.living_room_occupancy_presence
                      state: "on"
                  sequence:
                    - action: input_select.select_option
                      metadata: {}
                      data:
                        option: entering_confirm
                      target:
                        entity_id: input_select.living_room_occupancy_state
                - conditions:
                    - condition: template
                      value_template: "{{ doors_have_activity }}"
                  sequence:
                    - action: timer.pause
                      metadata: {}
                      data: {}
                      target:
                        entity_id: timer.living_room_occupancy_timer
                - conditions:
                    - condition: state
                      entity_id: timer.living_room_occupancy_timer
                      state: paused
                  sequence:
                    - action: timer.start
                      metadata: {}
                      data: {}
                      target:
                        entity_id: timer.living_room_occupancy_timer
                - conditions:
                    - condition: state
                      entity_id: timer.living_room_occupancy_timer
                      state: idle
                  sequence:
                    - action: input_select.select_option
                      metadata: {}
                      data:
                        option: absent
                      target:
                        entity_id: input_select.living_room_occupancy_state
        - conditions:
            - condition: state
              entity_id: input_select.living_room_occupancy_state
              state: entering_confirm
          sequence:
            - choose:
                - conditions:
                    - condition: state
                      entity_id: binary_sensor.living_room_occupancy_presence
                      state: "off"
                  sequence:
                    - action: input_select.select_option
                      metadata: {}
                      data:
                        option: entering
                      target:
                        entity_id: input_select.living_room_occupancy_state
                - conditions:
                    - condition: state
                      entity_id: timer.living_room_occupancy_timer
                      state: idle
                  sequence:
                    - action: input_select.select_option
                      metadata: {}
                      data:
                        option: present
                      target:
                        entity_id: input_select.living_room_occupancy_state
        - conditions:
            - condition: state
              entity_id: input_select.living_room_occupancy_state
              state: present
          sequence:
            - if:
                - condition: template
                  value_template: "{{ doors_have_activity }}"
              then:
                - action: input_select.select_option
                  metadata: {}
                  data:
                    option: leaving
                  target:
                    entity_id: input_select.living_room_occupancy_state
        - conditions:
            - condition: state
              entity_id: input_select.living_room_occupancy_state
              state: leaving
          sequence:
            - choose:
                - conditions:
                    - condition: state
                      entity_id: binary_sensor.living_room_occupancy_presence
                      state: "off"
                  sequence:
                    - action: input_select.select_option
                      metadata: {}
                      data:
                        option: leaving_confirm
                      target:
                        entity_id: input_select.living_room_occupancy_state
                - conditions:
                    - condition: template
                      value_template: "{{ doors_have_activity }}"
                  sequence:
                    - action: timer.pause
                      metadata: {}
                      data: {}
                      target:
                        entity_id: timer.living_room_occupancy_timer
                - conditions:
                    - condition: state
                      entity_id: timer.living_room_occupancy_timer
                      state: paused
                  sequence:
                    - action: timer.start
                      metadata: {}
                      data: {}
                      target:
                        entity_id: timer.living_room_occupancy_timer
                - conditions:
                    - condition: state
                      entity_id: timer.living_room_occupancy_timer
                      state: idle
                  sequence:
                    - action: input_select.select_option
                      metadata: {}
                      data:
                        option: present
                      target:
                        entity_id: input_select.living_room_occupancy_state
        - conditions:
            - condition: state
              entity_id: input_select.living_room_occupancy_state
              state: leaving_confirm
          sequence:
            - choose:
                - conditions:
                    - condition: state
                      entity_id: binary_sensor.living_room_occupancy_presence
                      state: "on"
                  sequence:
                    - action: input_select.select_option
                      metadata: {}
                      data:
                        option: leaving
                      target:
                        entity_id: input_select.living_room_occupancy_state
                - conditions:
                    - condition: state
                      entity_id: timer.living_room_occupancy_timer
                      state: idle
                  sequence:
                    - action: input_select.select_option
                      metadata: {}
                      data:
                        option: absent
                      target:
                        entity_id: input_select.living_room_occupancy_state
  mode: single
