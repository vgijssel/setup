---
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: local-ssd
  annotations:
    storageclass.kubernetes.io/is-default-class: "true"
provisioner: linstor.csi.linbit.com
parameters:
  linstor.csi.linbit.com/storagePool: ssd
  linstor.csi.linbit.com/layerList: storage
  linstor.csi.linbit.com/allowRemoteVolumeAccess: "false"
volumeBindingMode: WaitForFirstConsumer
allowVolumeExpansion: true
---
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  # Somewhere "replicated" is hardcoded so we need to call this that
  name: replicated
provisioner: linstor.csi.linbit.com
parameters:
  linstor.csi.linbit.com/storagePool: ssd
  linstor.csi.linbit.com/autoPlace: "3"
  linstor.csi.linbit.com/layerList: drbd storage
  linstor.csi.linbit.com/allowRemoteVolumeAccess: "true"
  # Quorum and failover settings
  property.linstor.csi.linbit.com/DrbdOptions/auto-quorum: suspend-io
  property.linstor.csi.linbit.com/DrbdOptions/Resource/on-no-data-accessible: suspend-io
  property.linstor.csi.linbit.com/DrbdOptions/Resource/on-suspended-primary-outdated: force-secondary
  property.linstor.csi.linbit.com/DrbdOptions/Net/rr-conflict: retry-connect
  # DRBD resync tuning for 25Gbps dedicated storage network with NVMe SSDs
  # Reference: https://cozystack.io/docs/storage/drbd-tuning/
  # Note: 10x increase from previous 2.5Gbps values to match 25Gbps bandwidth
  # c-max-rate: 2 GB/s (~80% of 25Gbps theoretical, NVMe becomes bottleneck at 2.4 GB/s)
  property.linstor.csi.linbit.com/DrbdOptions/PeerDevice/c-max-rate: "2048000"
  # c-min-rate: 680 MB/s (1/3 of c-max-rate per LINBIT recommendation)
  property.linstor.csi.linbit.com/DrbdOptions/PeerDevice/c-min-rate: "696320"
  # resync-rate: starting point for dynamic controller (1/3 of c-max-rate)
  property.linstor.csi.linbit.com/DrbdOptions/PeerDevice/resync-rate: "696320"
  # c-plan-ahead: lookahead window in 1/10 seconds (20 = 2 seconds for larger bursts)
  property.linstor.csi.linbit.com/DrbdOptions/PeerDevice/c-plan-ahead: "20"
  # c-fill-target: buffer fill target in KiB (scaled for 25G: ~20 MiB)
  property.linstor.csi.linbit.com/DrbdOptions/PeerDevice/c-fill-target: "20480"
  # Network buffer tuning for 25Gbps throughput
  property.linstor.csi.linbit.com/DrbdOptions/Net/max-buffers: "65536"
  property.linstor.csi.linbit.com/DrbdOptions/Net/sndbuf-size: "33554432"
  property.linstor.csi.linbit.com/DrbdOptions/Net/rcvbuf-size: "33554432"
volumeBindingMode: Immediate
allowVolumeExpansion: true
