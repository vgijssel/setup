---
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: local-ssd
  annotations:
    storageclass.kubernetes.io/is-default-class: "true"
provisioner: linstor.csi.linbit.com
parameters:
  linstor.csi.linbit.com/storagePool: ssd
  linstor.csi.linbit.com/layerList: storage
  linstor.csi.linbit.com/allowRemoteVolumeAccess: "false"
volumeBindingMode: WaitForFirstConsumer
allowVolumeExpansion: true
---
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  # Somewhere "replicated" is hardcoded so we need to call this that
  name: replicated
provisioner: linstor.csi.linbit.com
parameters:
  linstor.csi.linbit.com/storagePool: ssd
  linstor.csi.linbit.com/autoPlace: "3"
  linstor.csi.linbit.com/layerList: drbd storage
  linstor.csi.linbit.com/allowRemoteVolumeAccess: "true"
  # Quorum and failover settings
  property.linstor.csi.linbit.com/DrbdOptions/auto-quorum: suspend-io
  property.linstor.csi.linbit.com/DrbdOptions/Resource/on-no-data-accessible: suspend-io
  property.linstor.csi.linbit.com/DrbdOptions/Resource/on-suspended-primary-outdated: force-secondary
  property.linstor.csi.linbit.com/DrbdOptions/Net/rr-conflict: retry-connect
  # DRBD resync tuning for 2.5Gbps network with NVMe SSDs
  # Reference: https://cozystack.io/docs/storage/drbd-tuning/
  # c-max-rate: 250 MB/s (~80% of 2.5Gbps, leaves headroom for app traffic)
  property.linstor.csi.linbit.com/DrbdOptions/PeerDevice/c-max-rate: "256000"
  # c-min-rate: 80 MB/s (1/3 of c-max-rate per LINBIT recommendation)
  property.linstor.csi.linbit.com/DrbdOptions/PeerDevice/c-min-rate: "81920"
  # resync-rate: starting point for dynamic controller (1/3 of c-max-rate)
  property.linstor.csi.linbit.com/DrbdOptions/PeerDevice/resync-rate: "81920"
  # c-plan-ahead: lookahead window in 1/10 seconds (10 = 1 second)
  property.linstor.csi.linbit.com/DrbdOptions/PeerDevice/c-plan-ahead: "10"
  # c-fill-target: buffer fill target in KiB (scaled from 2048 for 10G)
  property.linstor.csi.linbit.com/DrbdOptions/PeerDevice/c-fill-target: "1024"
  # Network buffer tuning for improved throughput
  property.linstor.csi.linbit.com/DrbdOptions/Net/max-buffers: "36864"
  property.linstor.csi.linbit.com/DrbdOptions/Net/sndbuf-size: "10485760"
  property.linstor.csi.linbit.com/DrbdOptions/Net/rcvbuf-size: "10485760"
volumeBindingMode: Immediate
allowVolumeExpansion: true
