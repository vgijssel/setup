apiVersion: v1
kind: ConfigMap
metadata:
  name: coder-workspace-config
  namespace: coder
  labels:
    app.kubernetes.io/name: coder-workspace-config
    app.kubernetes.io/part-of: coder
data:
  # Internal URL for Coder agent-to-server communication (uses cluster DNS)
  # Agents inside the cluster use this to avoid DNS mismatch with external URL
  coder_url: http://coder.coder.svc.cluster.local:80
  # Internal URL for envbuilder to push cached images (runs inside pods, uses cluster DNS)
  registry_url: coder-registry.coder.svc.cluster.local:5000
  # NodePort URL for kubelet to pull cached images (runs on host, uses host DNS)
  # Kubelet cannot resolve .svc.cluster.local addresses - it uses host DNS (systemd-resolved)
  # See: https://discuss.kubernetes.io/t/how-does-kubelet-dns-resolution-before-pod-creation-work/9489
  registry_pull_url: localhost:31500
