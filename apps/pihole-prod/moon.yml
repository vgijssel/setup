id: pihole-prod
language: javascript
layer: application
dependsOn:
  - ansible
tags:
  - scope.app
  - type.infrastructure
  - ansible
  - pihole
  - otbr
tasks:
  install-requirements:
    command: ansible-galaxy collection install -r ../../libs/ansible/requirements.yml
    options:
      runInCI: false
  bootstrap:
    command: ansible-playbook -i bootstrap pihole.yml --diff -e "ansible_host=@ARGS"
    options:
      runInCI: false
      interactive: true
  apply:
    command: ansible-playbook -i inventory pihole.yml --diff
    options:
      runInCI: false
      interactive: true
  validate:
    command: goss -g goss.yaml validate --format documentation
    options:
      runInCI: false # Requires SSH access to pihole-prod host
