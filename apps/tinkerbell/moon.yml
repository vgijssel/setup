id: tinkerbell
language: javascript
layer: application
tags:
  - scope.app
  - type.service
  - platform.kubernetes
  - scope.app
  - type.service
  - platform.kubernetes
tasks:
  dev:
    command: |
      limactl delete -f tinkerbell-lima || true
      limactl start ./tinkerbell-lima.yaml
      KUBECONFIG="$HOME/.kube/configs/tinkerbell-dev.yaml" kubectl config rename-context default tinkerbell-dev
      helmfile apply --wait
      kubie exec tinkerbell-dev tink kubectl apply -f hardware.yaml -f template.yaml -f ubuntu-download.yaml -f workflow.yaml
    local: true
  ipxe:
    command: |
      limactl delete -f ipxe-lima || true
      limactl start ./ipxe-lima.yaml
    local: true
