replicaCount: 1

# Adding host aliases to the metabase deployment
hostAliases: []
# - ip: "127.0.0.1"
#   hostnames:
#   - "foo.local"
#   - "bar.local"

## String to fully override metabase.fullname template
##
# fullnameOverride:

# Config Jetty web server
listen:
  host: "0.0.0.0"
  port: 3000

monitoring:
  enabled: false
  serviceMonitor:
    enabled: false
  port: 9191

jetty:
#  maxThreads: 254
#  minThreads: 8
#  maxQueued: -1
#  maxIdleTime: 60000

# Backend database
database:
  type: postgres

password:
  # strong: minimum 8 characters w/ 2 lowercase, 2 uppercase, 1 digit, and 1 special character
  complexity: strong
  length: 50

timeZone: UTC
emojiLogging: true
colorLogging: true
# javaOpts:
pluginsDirectory: /plugins
# siteUrl:

image:
  # TODO: temporary community image until official ARM image is available
  # https://github.com/metabase/metabase/issues/13119
  # https://github.com/DockARM/metabase-arm/pkgs/container/metabase-arm
  repository: ghcr.io/dockarm/metabase-arm
  tag: v0.52.6

ingress:
  enabled: true
  className: tailscale
  tls:
    - hosts:
        - metabase
  hosts:
    - "metabase"

extraInitContainers:
  - name: download-modules
    image: "curlimages/curl:7.70.0"
    imagePullPolicy: "IfNotPresent"
    volumeMounts:
      - name: plugins
        mountPath: /plugins
    workingDir: /plugins
    command:
      - "/bin/sh"
      - "-ec"
      - |
        curl -Lso /plugins/clickhouse.metabase-driver.jar \
                  https://github.com/ClickHouse/metabase-clickhouse-driver/releases/download/1.51.0/clickhouse.metabase-driver.jar

extraVolumeMounts:
  - name: plugins
    mountPath: /plugins
    readOnly: false

extraVolumes:
  - name: plugins
    emptyDir: {}
