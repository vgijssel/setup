version: "3"

tasks:
  dev:
    desc: Start the tinkerbell development environment
    cmds:
      - limactl delete -f tinkerbell-lima || true
      - limactl start ./tinkerbell-lima.yaml
      - KUBECONFIG="$HOME/.kube/configs/tinkerbell-dev.yaml" kubectl config rename-context default tinkerbell-dev
      - helmfile apply --wait

  # For console output use:
  # minicom -D unix#/Users/maarten/.lima/ipxe-lima/serial.sock
  ipxe:
    desc: Start the ipxe machine
    cmds:
      - limactl delete -f ipxe-lima || true
      - limactl disk delete ipxe-target || true
      - limactl disk create ipxe-target --size 20GiB
      - limactl start ./ipxe-lima.yaml
