
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Reaquiantance with valuable devops lessons through deploying PiKVM in various ways." name="description"/>
<meta content="Maarten van Gijssel" name="author"/>
<link href="https://vgijssel.github.io/setup/blog/deploying-pikvm-7-lessons-you-already-know/" rel="canonical"/>
<link href="../tags/pikvm/" rel="prev"/>
<link href="../../internal/bootstrap-provisioner-k8s/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.5.49" name="generator"/>
<title>Deploying PiKVM: 7 Lessons You Already Know - Maarten's House of Hackery</title>
<link href="../../assets/stylesheets/main.6f8fc17f.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../assets/stylesheets/blog.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/blog.min.css.map" rel="stylesheet"/>
<link href="../../assets/stylesheets/obsidian.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/obsidian.min.css.map" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<meta content="article" property="og:type"/><meta content="Deploying PiKVM: 7 Lessons You Already Know - Maarten's House of Hackery" property="og:title"/><meta content="Reaquiantance with valuable devops lessons through deploying PiKVM in various ways." property="og:description"/><meta content="Maarten's House of Hackery" property="og:site_name"/><meta content="en_us" property="og:locale"/><meta content="https://vgijssel.github.io/setup/blog/deploying-pikvm-7-lessons-you-already-know/" property="og:url"/><meta content="https://vgijssel.github.io/setup/./images/pikvm-lessons-learned.jpeg" property="og:image"/><meta content="summary_large_image" property="twitter:card"/><meta content="Deploying PiKVM: 7 Lessons You Already Know - Maarten's House of Hackery" property="twitter:title"/><meta content="Reaquiantance with valuable devops lessons through deploying PiKVM in various ways." property="twitter:description"/><meta content="https://vgijssel.github.io/setup/./images/pikvm-lessons-learned.jpeg" property="twitter:image"/></head>
<body dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#windmill-in-pikvm-host-os">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Maarten's House of Hackery" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Maarten's House of Hackery">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Maarten's House of Hackery
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Deploying PiKVM: 7 Lessons You Already Know
            
          </span>
</div>
</div>
</div>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
</a>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/vgijssel/setup" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    setup
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../..">
        
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../">
          
  
    
  
  Blog

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../internal/bootstrap-provisioner-k8s/">
          
  
    
  
  Internal

        </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Maarten's House of Hackery" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Maarten's House of Hackery">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    Maarten's House of Hackery
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/vgijssel/setup" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    setup
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    Home
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../">
<span class="md-ellipsis">
    Blog
  </span>
</a>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Blog
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
<span class="md-ellipsis">
    Archive
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_2">
<span class="md-nav__icon md-icon"></span>
            Archive
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../archive/2025/">
<span class="md-ellipsis">
    2025
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
<span class="md-ellipsis">
    Categories
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_3">
<span class="md-nav__icon md-icon"></span>
            Categories
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../categories/devops/">
<span class="md-ellipsis">
    devops
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../categories/failure/">
<span class="md-ellipsis">
    failure
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../categories/virtualisation/">
<span class="md-ellipsis">
    virtualisation
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
<span class="md-ellipsis">
    Tags
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_4">
<span class="md-nav__icon md-icon"></span>
            Tags
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../tags/ansible/">
<span class="md-ellipsis">
    ansible
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../tags/incus/">
<span class="md-ellipsis">
    incus
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../tags/lxc/">
<span class="md-ellipsis">
    lxc
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../tags/packer/">
<span class="md-ellipsis">
    packer
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../tags/pikvm/">
<span class="md-ellipsis">
    pikvm
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    Internal
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            Internal
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../internal/bootstrap-provisioner-k8s/">
<span class="md-ellipsis">
    Bootstrap provisioner-k8s
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#windmill-in-pikvm-host-os">
<span class="md-ellipsis">
      Windmill in PiKVM Host OS
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pikvm-in-esxi-arm-fling-vm">
<span class="md-ellipsis">
      PiKVM in ESXi-Arm Fling VM
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pikvm-in-pimox-vm">
<span class="md-ellipsis">
      PiKVM in Pimox VM
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kvmd-armbian-in-pimox-host-os">
<span class="md-ellipsis">
      Kvmd-armbian in Pimox Host OS
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kvmd-armbian-in-pimox-lxc">
<span class="md-ellipsis">
      Kvmd-armbian in Pimox LXC
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kvmd-armbian-in-incus-lxc">
<span class="md-ellipsis">
      Kvmd-armbian in Incus LXC
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pikvm-in-incus-lxc">
<span class="md-ellipsis">
      PiKVM in Incus LXC
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#closing-thoughts">
<span class="md-ellipsis">
      Closing Thoughts
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#code-snippets">
<span class="md-ellipsis">
      Code Snippets
    </span>
</a>
<nav aria-label="Code Snippets" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#fix-oled-screen-for-kvmd-armbian">
<span class="md-ellipsis">
      Fix OLED Screen for Kvmd-armbian
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#passthrough-gpio-for-atx-control">
<span class="md-ellipsis">
      Passthrough GPIO for ATX Control
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#passthrough-otg-port-for-keyboardmouse">
<span class="md-ellipsis">
      Passthrough OTG Port for keyboard/mouse
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#passthrough-hdmi-capture-card">
<span class="md-ellipsis">
      Passthrough HDMI Capture Card
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#passthrough-i2c-for-the-oled-screen">
<span class="md-ellipsis">
      Passthrough I2C for the OLED Screen
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#incus-kvmd-armbian-lxc-container-with-passthrough">
<span class="md-ellipsis">
      Incus Kvmd-armbian LXC Container with Passthrough
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#incus-pikvm-lxc-container-with-passthrough">
<span class="md-ellipsis">
      Incus PiKVM LXC Container with Passthrough
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/vgijssel/setup/edit/master/docs/02_blog/deploying-pikvm-7-lessons-you-already-know.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"></path></svg>
</a>
<a class="md-content__button md-icon" href="https://github.com/vgijssel/setup/raw/master/docs/02_blog/deploying-pikvm-7-lessons-you-already-know.md" title="View source of this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"></path></svg>
</a>
<h1>Deploying PiKVM: 7 Lessons You Already Know</h1>
<p><img alt="None" src="../../images/pikvm-lessons-learned.jpeg"/></p>
<p><strong>TL;DR If you are thinking about using the Raspberry Pi 4 (Pi) which hosts PiKVM for multiple use cases, just get a second Pi. It will save you a lot of time.</strong></p>
<p>Having <strong>not</strong> read the <a href="https://docs.pikvm.org/">PiKVM</a> documentation thoroughly (reading <em>is</em> hard after all) I decided to purchase the <a href="https://wiki.geekworm.com/KVM-A3">Geekworm KVM-A3</a> with a Pi 8GiB instead of the recommend 1GiB to host both the PiKVM OS and <a href="https://www.windmill.dev/">Windmill</a> inside of <a href="https://k3s.io">K3S</a>. I was about to learn this was actually a lot harder than I imagined it would be.</p>
<!-- more -->
<h2 id="windmill-in-pikvm-host-os">Windmill in PiKVM Host OS<a class="headerlink" href="#windmill-in-pikvm-host-os" title="Permanent link">¶</a></h2>
<p>PiKVM is based on Arch Linux, which supports K3s. The only notable difference? Its read-only filesystem! Let’s change that.</p>
<h4>Steps</h4>
<ol>
<li>Circumvent read-only file system as described <a href="https://docs.pikvm.org/faq/">here</a>. (Tip: Look for instructions between the giant warning banners 😂).<br/>
<img alt="pikvm-read-write-warning.png" loading="lazy" src="../../images/pikvm-read-write-warning.png"/></li>
<li>Install K3s</li>
<li>Setup <a href="https://helmfile.readthedocs.io/en/latest/">helmfile</a> with the Windmill chart</li>
<li>Run <code>helmfile apply</code></li>
<li>Watch it fail 🤦‍♂️</li>
</ol>
<h4>Result</h4>
<p>I was surprised it took a really long time to start the Windmill pods. Checking out the kubectl logs I came to the realisation that k3s was unable to pull an image from the registry due to a mismatch in architecture. The <a href="https://github.com/windmill-labs/windmill/pkgs/container/windmill">Windmill package</a> only supports <code>arm64</code>, while PiKVM runs on <code>armhf</code>.</p>
<div class="admonition tip">
<p class="admonition-title">Lesson 1</p>
<p>Do your due diligence! Arm64 and armhf are different architectures, and software compatibility isn’t guaranteed.</p>
</div>
<h2 id="pikvm-in-esxi-arm-fling-vm">PiKVM in ESXi-Arm Fling VM<a class="headerlink" href="#pikvm-in-esxi-arm-fling-vm" title="Permanent link">¶</a></h2>
<p>PiKVM doesn’t offer a 64-bit version of the OS (<a href="https://github.com/pikvm/pi-builder/issues/4">source</a>, <a href="https://github.com/pikvm/pikvm/issues/711">source</a>), yet I needed to run 64-bit and 32-bit software on the same machine. Enter <a href="https://williamlam.com/2024/10/new-esxi-arm-fling-based-on-8-0-update-3b.html">ESXi-Arm Fling</a>. Success guaranteed of course, as ESXi is built and maintained by a reputable company.</p>
<h4>Steps</h4>
<ol>
<li>Create an account on <a href="https://access.broadcom.com/default/ui/v1/signin/">the Broadcom website</a> and download the documentation</li>
<li>
<p>From the documentation</p>
<ol>
<li>Update Raspberry Pi 4 EEPROM</li>
<li>Flash UEFI to sdcard from <a href="https://github.com/pftf/RPi4/releases">https://github.com/pftf/RPi4/releases</a></li>
<li>
<p>Make OSData partition 25gb by passing this in the boot screen (to not have ESXi take all the space in the thumb-drive)</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nv">systemMediaSize</span><span class="o">=</span>min
</code></pre></div>
</li>
<li>
<p>When asked for a ESX OSData store when installing on a USB attached disk press enter to skip this, otherwise you’ll get a cryptic error and have to start over.</p>
</li>
<li>Get license code from <a href="https://gist.github.com/ayebrian/646775424393c9a35fb8257f44df1c8b">this gist</a> who is kind enough to share it with the rest of the world.</li>
<li>Add license code to ESXi</li>
<li><a href="https://files.pikvm.org/images/v3-hdmi-rpi4-box-latest.img.xz">Download official PiKVM v3 image</a></li>
<li>Convert the image to vmdk</li>
</ol>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a>qemu-img<span class="w"> </span>convert<span class="w"> </span>-f<span class="w"> </span>raw<span class="w"> </span>-O<span class="w"> </span>vmdk<span class="w"> </span>~/Downloads/v3-hdmi-rpi4-box-latest.img<span class="w"> </span>~/Downloads/v3-hdmi-rpi4-box-latest.vmdk
</code></pre></div>
</li>
<li>
<p>Upload <code>v3-hdmi-rpi4-box-latest.vmdk</code></p>
</li>
<li>Configure the <code>pikvm</code> virtual machine<br/>
<img alt="esxi-vm-settings.png" loading="lazy" src="../../images/esxi-vm-settings.png"/></li>
<li>Attach the uploaded disk to the virtual machine</li>
<li>Boot the machine</li>
<li>Watch if fail 🤦‍♂️</li>
</ol>
<h4>Result</h4>
<p>The VM wouldn’t boot—a 32-bit PiKVM image can’t run as a 64-bit VM. I also tried to run the virtual machine with the Debian net installer: <a href="https://cdimage.debian.org/debian-cd/current/arm64/iso-cd/">https://cdimage.debian.org/debian-cd/current/arm64/iso-cd/</a> and trying add grub to the root file system, but with no success.</p>
<div class="admonition tip">
<p class="admonition-title">Lesson 2</p>
<p>Details matter! Not all OS images work with hypervisors. The Pi has a unique boot process.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Lesson 3</p>
<p>Temper expectations with early-access software. ESXi-Arm Fling doesn’t support 32-bit arm VMs (<a href="https://williamlam.com/2020/10/how-to-run-raspberry-pi-os-as-a-vm-on-esxi-arm.html">source</a>, <a href="https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=250308#c2">source</a>).</p>
</div>
<h2 id="pikvm-in-pimox-vm">PiKVM in Pimox VM<a class="headerlink" href="#pikvm-in-pimox-vm" title="Permanent link">¶</a></h2>
<p>Pimox (Proxmox + Pi) seemed promising based on <a href="https://www.reddit.com/r/Proxmox/comments/nvdb1z/proxmox_on_the_raspberry_pi_now_supports_32bit/">this Reddit post</a> with support for 32-bit VMs.</p>
<h4>Steps</h4>
<ol>
<li>Install Pimox (<a href="https://github.com/jiangcuo/Proxmox-Port">source</a>, <a href="https://fleetstack.io/blog/install-proxmox-on-raspberry-pi">source</a>, <a href="https://pimylifeup.com/raspberry-pi-proxmox">source</a>, <a href="https://gist.github.com/enjikaka/52d62c9c5462748dbe35abe3c7e37f9a">source</a>, <a href="https://www.bachmann-lan.de/proxmox-8-auf-dem-raspberry-pi-4-installieren/">source</a>)</li>
<li>Create and run an Ansible Playbook (see <a href="https://github.com/vgijssel/setup/pull/676">pull request</a>)</li>
<li>Initialise a Proxmox VM</li>
<li>Search for the device passthrough section to passthrough the following devices:<ol>
<li>OTG port for keyboard/mouse/mass storage device (msd) emulation on the target the PiKVM is attached to</li>
<li>HDMI capture card and hardware H264 encoding for streaming target video output</li>
<li>GPIO for ATX control for power on/off control</li>
<li>I2C for the OLED screen</li>
</ol>
</li>
<li>Fail 🤦‍♂️</li>
</ol>
<h4>Result</h4>
<p>Hypervisors like Proxmox can’t easily passthrough all devices from host to guest. I did some reading about <a href="https://www.openeuler.org/en/blog/wxggg/2020-11-29-vfio-passthrough-2.html">vfio passthrough</a> but that was waaaay out of my comfort zone, so I decided to give up on running PiKVM inside a vm.</p>
<p>Thanks for <a href="https://discord.com/channels/1138148231180714085/1138148231663067258/1321907940382343209">helping me set up PiKVM in a vm @srepac</a>!</p>
<div class="admonition tip">
<p class="admonition-title">Lesson 4</p>
<p>Tackle highest risk first. Device passthrough in VMs is complex. Not all devices can be passed to guests.</p>
</div>
<h2 id="kvmd-armbian-in-pimox-host-os">Kvmd-armbian in Pimox Host OS<a class="headerlink" href="#kvmd-armbian-in-pimox-host-os" title="Permanent link">¶</a></h2>
<p>Suffering from <a href="https://en.wikipedia.org/wiki/Sunk_cost">sunk cost fallacy</a> big time I kept pursuing my goal. Determined I found <a href="https://github.com/srepac/kvmd-armbian">kvmd-armbian</a> which is an unofficial port that supports 32-bit, 64-bit on arm AND x86 machines. Bonus points having a <a href="https://discord.gg/64EQQuwjsB">Discord channel</a> for support.</p>
<h4>Steps</h4>
<ol>
<li>Install Pimox</li>
<li>Create and run an Ansible Playbook</li>
<li>Run installer from kvmd-armbian</li>
<li>
<p>Disable the Pimox firewall to get access to the kvmd web ui (Tip: Please enable it again if you plan deploy like this 😅)</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a>pve-firewall<span class="w"> </span>stop
</code></pre></div>
</li>
<li>
<p><a href="#fix-oled-screen-for-kvmd-armbian">Fix OLED screen for kvmd-armbian</a></p>
</li>
<li>Celebrate 🎉</li>
</ol>
<h4>Result</h4>
<p>With help from the kvmd-armbian community ❤️ it worked, but running two unofficial setups (Pimox + kvmd-armbian) in the host OS felt unsustainable. If one of the projects would stop developing I’d have to start over.</p>
<div class="admonition tip">
<p class="admonition-title">Lesson 5</p>
<p>Prioritize long-term maintainability.</p>
</div>
<h2 id="kvmd-armbian-in-pimox-lxc">Kvmd-armbian in Pimox LXC<a class="headerlink" href="#kvmd-armbian-in-pimox-lxc" title="Permanent link">¶</a></h2>
<p>If I can’t run kvmd-armbian on the host and not in a VM, what are my options? I looked into docker containers and <a href="https://linuxcontainers.org/lxc/introduction/">LXC containers</a>. As LXC is closer to a vm than Docker and PiKVM has specific host requirements like an additional partition for msd, I decided to go with LXC.</p>
<h4>Steps</h4>
<ol>
<li>Download LXC Jammy and create a container template (<a href="https://benheater.com/proxmox-lxc-using-external-templates/">source</a>)</li>
<li>Create an LXC container with the following settings<ol>
<li><strong>Hostname</strong>: pikvm</li>
<li>UNCHECK - unprivileged container (so <strong>privileged</strong> container)</li>
<li><strong>Password</strong>: Password1234 (Tip: don’t)</li>
</ol>
</li>
<li>Start the LXC container and attach the console</li>
<li>Run kvmd-installer</li>
<li><a href="#fix-oled-screen-for-kvmd-armbian">Fix OLED screen for kvmd-armbian</a></li>
<li>Forward devices from host to guest (I have to admit this was <em>pretty</em> time consuming 😅)<ol>
<li><a href="#passthrough-gpio-for-atx-control">Passthrough GPIO for ATX control</a></li>
<li><a href="#passthrough-otg-port-for-keyboardmouse">Passthrough OTG port for keyboard/mouse</a></li>
<li><a href="#passthrough-otg-port-for-keyboardmouse">Passthrough OTG port for keyboard/mouse</a></li>
<li><a href="#passthrough-hdmi-capture-card">Passthrough HDMI capture card</a></li>
<li><a href="#passthrough-i2c-for-the-oled-screen">Passthrough I2C for the OLED screen</a></li>
</ol>
</li>
<li>Celebrate 🎉</li>
</ol>
<h4>Result</h4>
<p>This separation enabled easier updates for both host and guest OS, leaving me less worried about potential future breakage.</p>
<div class="admonition tip">
<p class="admonition-title">Lesson 6</p>
<p>Ask for help! LXC and device passthrough are pretty far out of my comfort zone, I used ChatGPT which was incredibly helpful!</p>
</div>
<h2 id="kvmd-armbian-in-incus-lxc">Kvmd-armbian in Incus LXC<a class="headerlink" href="#kvmd-armbian-in-incus-lxc" title="Permanent link">¶</a></h2>
<p>Next I decided to see if it’s possible to use a hypervisor which is officially supported on arm AND supports LXC out of the box. I investigated the following, not an exhaustive list:</p>
<table>
<thead>
<tr>
<th>Hypervisor</th>
<th>Raspberry Pi 4 support</th>
<th>LXC support</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://williamlam.com/2024/10/new-esxi-arm-fling-based-on-8-0-update-3b.html">ESXI Arm Fling</a></td>
<td>✅</td>
<td>❌</td>
</tr>
<tr>
<td><a href="https://github.com/jiangcuo/Proxmox-Port">Proxmox</a></td>
<td>✅: Using unofficial Pimox port</td>
<td>✅</td>
</tr>
<tr>
<td><a href="https://xcp-ng.org/">xcp ng</a></td>
<td>❌: <a href="https://xcp-ng.org/blog/2024/04/03/integrating-xen-on-the-ampere-platform-a-first-look/">Work in progress</a></td>
<td>❌: Abandoned initiative <a href="https://github.com/xcp-ng/runx">RunX</a></td>
</tr>
<tr>
<td><a href="https://github.com/cloud-hypervisor/cloud-hypervisor">Cloud hypervisor</a></td>
<td>✅</td>
<td>❌</td>
</tr>
<tr>
<td><a href="https://github.com/lxc/incus">Incus</a></td>
<td>✅</td>
<td>✅</td>
</tr>
</tbody>
</table>
<p>The choice landed on Incus (see <a href="https://github.com/vgijssel/setup/pull/679">pull request</a>).</p>
<h4>Steps</h4>
<ol>
<li>Using Raspberry Pi Imager:<ol>
<li><strong>OS</strong>: Ubuntu Server 24.04 LTS 64-bit</li>
<li><strong>Username</strong>: deploy</li>
<li><strong>Hostname</strong>: provisioner</li>
<li><strong>Password</strong>: <code>Password1234</code></li>
</ol>
</li>
<li>
<p>Setup Incus host using Ansible playbook</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a>ansible-playbook<span class="w"> </span>-i<span class="w"> </span>./production.local<span class="w"> </span>provisioner.yml<span class="w"> </span>--diff
</code></pre></div>
</li>
<li>
<p>Create <a href="#incus-kvmd-armbian-lxc-container-with-passthrough">Incus kvmd-armbian LXC container with passthrough</a></p>
</li>
<li>
<p>Start the LXC container</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a>incus<span class="w"> </span>start<span class="w"> </span>kvmd
</code></pre></div>
</li>
<li>
<p>Run the kvmd-armbian installer</p>
</li>
<li><a href="#fix-oled-screen-for-kvmd-armbian">Fix OLED screen for kvmd-armbian</a></li>
<li>
<p>Restart the container</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a>incus<span class="w"> </span>restart<span class="w"> </span>kvmd
</code></pre></div>
</li>
<li>
<p>Celebrate 🎉</p>
</li>
</ol>
<h4>Result</h4>
<p>A clean, supported hypervisor setup (many kudos to the Incus team 👏). At this point I’m pretty happy. But having spent all this time, it would be a waste not to spend <strong>EVEN MORE</strong> time trying to improve things.</p>
<h2 id="pikvm-in-incus-lxc">PiKVM in Incus LXC<a class="headerlink" href="#pikvm-in-incus-lxc" title="Permanent link">¶</a></h2>
<p>Inspired by <a href="https://github.com/Prototyped/pikvm-container">pikvm-container</a>, a (dated) implementation of running PiKVM inside a docker container, I adapted the official PiKVM image for LXC (see <a href="https://github.com/vgijssel/setup/pull/679">pull request</a> with <a href="https://www.packer.io/">Packer</a> pipeline).</p>
<h4>Steps</h4>
<ol>
<li><a href="https://files.pikvm.org/images/v3-hdmi-rpi4-box-latest.img.xz">Download official PiKVM v3 image</a></li>
<li>Extract partitions using 7zip</li>
<li>
<p>Loop mount partitions</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>/mnt/rootfs
<a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>/mnt/rootfs/boot
<a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a>mount<span class="w"> </span>-o<span class="w"> </span>loop<span class="w"> </span><span class="m">2</span>.img<span class="w"> </span>/mnt/rootfs
<a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a>mount<span class="w"> </span>-o<span class="w"> </span>loop<span class="w"> </span><span class="m">0</span>.fat<span class="w"> </span>/mnt/rootfs/boot
</code></pre></div>
</li>
<li>
<p>Use <a href="https://github.com/lxc/distrobuilder">distrobuilder</a> to convert<code>/mnt/rootfs</code> into an Incus LXC image with modifications</p>
<ol>
<li>Remove <code>/etc/fstab</code></li>
<li>Disable msd</li>
<li>Add a systemd boot service to generate certificates</li>
<li>Mask service <code>kvmd-pst</code>, <code>kvmd-fan</code>, <code>kvmd-watchdog</code> and <code>kvmd-bootconfig</code> because PiKVM works without those (and I don’t want to spend more time fixing those services 😂)</li>
</ol>
</li>
<li>
<p>Import the image into Incus</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a>incus<span class="w"> </span>image<span class="w"> </span>import<span class="w"> </span>pikvm-rpi4.tar.xz<span class="w"> </span>--alias<span class="w"> </span>pikvm-rpi4/latest
</code></pre></div>
</li>
<li>
<p>Create <a href="#incus-pikvm-lxc-container-with-passthrough">Incus PiKVM LXC container with passthrough</a></p>
</li>
<li>
<p>Check the console for errors</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a>incus<span class="w"> </span>console<span class="w"> </span>pikvm<span class="w"> </span>--show-log
</code></pre></div>
</li>
<li>
<p>Celebrate 🎉</p>
</li>
</ol>
<h4>Result</h4>
<p>Success! I’m running an officially supported hypervisor and a <em>hacky</em>-officially supported installation of PiKVM inside an LXC container! Now I can get back to what I was doing, spinning up Windmill.</p>
<div class="admonition tip">
<p class="admonition-title">Lesson 7</p>
<p>The on holder wins 🇳🇱 (in regular English: Persistence pays off)</p>
</div>
<h2 id="closing-thoughts">Closing Thoughts<a class="headerlink" href="#closing-thoughts" title="Permanent link">¶</a></h2>
<p>Thanks to the kvmd-armbian community, Google, Reddit, and ChatGPT, I’ve gained invaluable insights into the Raspberry Pi, hypervisors, and device passthrough. Would I recommend this journey? Probably not—just get a second Pi for PiKVM. But where’s the fun in that? 😆</p>
<hr/>
<h2 id="code-snippets">Code Snippets<a class="headerlink" href="#code-snippets" title="Permanent link">¶</a></h2>
<h3 id="fix-oled-screen-for-kvmd-armbian">Fix OLED Screen for Kvmd-armbian<a class="headerlink" href="#fix-oled-screen-for-kvmd-armbian" title="Permanent link">¶</a></h3>
<p>Copied from <a href="https://discord.com/channels/1138148231180714085/1138148231663067258/1323568386189295669">Discord comment</a></p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>python3-usb<span class="w"> </span>python3-luma.core<span class="w"> </span>python3-luma.lcd<span class="w"> </span>python3-luma.oled
<a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a>
<a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>/usr/share/fonts/TTF
<a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a>curl<span class="w"> </span>-L<span class="w"> </span>https://github.com/pikvm/kvmd/raw/ebda7ea03d178ebf93f115eaa75cf059e010cd96/kvmd/apps/oled/fonts/ProggySquare.ttf<span class="w"> </span>--output<span class="w"> </span>/usr/share/fonts/TTF/ProggySquare.ttf
<a href="#__codelineno-9-5" id="__codelineno-9-5" name="__codelineno-9-5"></a>
<a href="#__codelineno-9-6" id="__codelineno-9-6" name="__codelineno-9-6"></a>curl<span class="w"> </span>-L<span class="w"> </span>https://kvmnerds.com/REPO/NEW/kvmd-oled-0.26-1-any.pkg.tar.xz<span class="w"> </span>--output<span class="w"> </span>/tmp/kvmd-oled-0.26-1-any.pkg.tar.xz
<a href="#__codelineno-9-7" id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="nb">cd</span><span class="w"> </span>/
<a href="#__codelineno-9-8" id="__codelineno-9-8" name="__codelineno-9-8"></a>tar<span class="w"> </span>xfJ<span class="w"> </span>/tmp/kvmd-oled-0.26-1-any.pkg.tar.xz
<a href="#__codelineno-9-9" id="__codelineno-9-9" name="__codelineno-9-9"></a>
<a href="#__codelineno-9-10" id="__codelineno-9-10" name="__codelineno-9-10"></a>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>/usr/lib/systemd/system/kvmd-oled-reboot.service
<a href="#__codelineno-9-11" id="__codelineno-9-11" name="__codelineno-9-11"></a>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>/usr/lib/systemd/system/kvmd-oled.service
<a href="#__codelineno-9-12" id="__codelineno-9-12" name="__codelineno-9-12"></a>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>/usr/lib/systemd/system/kvmd-oled-shutdown.service
</code></pre></div>
<h3 id="passthrough-gpio-for-atx-control">Passthrough GPIO for ATX Control<a class="headerlink" href="#passthrough-gpio-for-atx-control" title="Permanent link">¶</a></h3>
<ol>
<li>
<p>I used the output of <code>journalctl -f</code> to figure out where kvmd-armbian would break:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a>Dec<span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">19</span>:36:40<span class="w"> </span>pikvm<span class="w"> </span>kvmd<span class="o">[</span><span class="m">602</span><span class="o">]</span>:<span class="w"> </span>File<span class="w"> </span><span class="s2">"/usr/bin/kvmd"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">8</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>&lt;module&gt;
<a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a>Dec<span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">19</span>:36:40<span class="w"> </span>pikvm<span class="w"> </span>kvmd<span class="o">[</span><span class="m">602</span><span class="o">]</span>:<span class="w"> </span>sys.exit<span class="o">(</span>main<span class="o">())</span>
<a href="#__codelineno-10-3" id="__codelineno-10-3" name="__codelineno-10-3"></a>Dec<span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">19</span>:36:40<span class="w"> </span>pikvm<span class="w"> </span>kvmd<span class="o">[</span><span class="m">602</span><span class="o">]</span>:<span class="w"> </span>File<span class="w"> </span><span class="s2">"/usr/lib/python3/dist-packages/kvmd/apps/kvmd/__init__.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">75</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>main
<a href="#__codelineno-10-4" id="__codelineno-10-4" name="__codelineno-10-4"></a>Dec<span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">19</span>:36:40<span class="w"> </span>pikvm<span class="w"> </span>kvmd<span class="o">[</span><span class="m">602</span><span class="o">]</span>:<span class="w"> </span>KvmdServer<span class="o">(</span>
<a href="#__codelineno-10-5" id="__codelineno-10-5" name="__codelineno-10-5"></a>Dec<span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">19</span>:36:40<span class="w"> </span>pikvm<span class="w"> </span>kvmd<span class="o">[</span><span class="m">602</span><span class="o">]</span>:<span class="w"> </span>File<span class="w"> </span><span class="s2">"/usr/lib/python3/dist-packages/kvmd/apps/kvmd/server.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">263</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>run
<a href="#__codelineno-10-6" id="__codelineno-10-6" name="__codelineno-10-6"></a>Dec<span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">19</span>:36:40<span class="w"> </span>pikvm<span class="w"> </span>kvmd<span class="o">[</span><span class="m">602</span><span class="o">]</span>:<span class="w"> </span>comp.sysprep<span class="o">()</span>
<a href="#__codelineno-10-7" id="__codelineno-10-7" name="__codelineno-10-7"></a>Dec<span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">19</span>:36:40<span class="w"> </span>pikvm<span class="w"> </span>kvmd<span class="o">[</span><span class="m">602</span><span class="o">]</span>:<span class="w"> </span>File<span class="w"> </span><span class="s2">"/usr/lib/python3/dist-packages/kvmd/apps/kvmd/ugpio.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">294</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>sysprep
<a href="#__codelineno-10-8" id="__codelineno-10-8" name="__codelineno-10-8"></a>Dec<span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">19</span>:36:40<span class="w"> </span>pikvm<span class="w"> </span>kvmd<span class="o">[</span><span class="m">602</span><span class="o">]</span>:<span class="w"> </span>driver.prepare<span class="o">()</span>
<a href="#__codelineno-10-9" id="__codelineno-10-9" name="__codelineno-10-9"></a>Dec<span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">19</span>:36:40<span class="w"> </span>pikvm<span class="w"> </span>kvmd<span class="o">[</span><span class="m">602</span><span class="o">]</span>:<span class="w"> </span>File<span class="w"> </span><span class="s2">"/usr/lib/python3/dist-packages/kvmd/plugins/ugpio/gpio.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">86</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>prepare
<a href="#__codelineno-10-10" id="__codelineno-10-10" name="__codelineno-10-10"></a>Dec<span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">19</span>:36:40<span class="w"> </span>pikvm<span class="w"> </span>kvmd<span class="o">[</span><span class="m">602</span><span class="o">]</span>:<span class="w"> </span>self.__chip<span class="w"> </span><span class="o">=</span><span class="w"> </span>gpiod.Chip<span class="o">(</span>self.__device_path<span class="o">)</span><span class="w"> </span>Dec<span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">19</span>:36:40<span class="w"> </span>pikvm<span class="w"> </span>kvmd<span class="o">[</span><span class="m">602</span><span class="o">]</span>:<span class="w"> </span>PermissionError:<span class="w"> </span><span class="o">[</span>Errno<span class="w"> </span><span class="m">1</span><span class="o">]</span><span class="w"> </span>Operation<span class="w"> </span>not<span class="w"> </span>permitted
</code></pre></div>
</li>
<li>
<p>Running <code>kvmd -m</code> showed me what gpio device what was spected</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="nt">kvmd</span><span class="p">:</span>
<a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="w"> </span><span class="nt">atx</span><span class="p">:</span>
<a href="#__codelineno-11-3" id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="w">   </span><span class="nt">device</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dev/gpiochip0</span>
</code></pre></div>
</li>
<li>
<p>Update the LXC template</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="c1"># 254 is the major number as can be seen by the ls command OR stat /dev/gpiochip0</span>
<a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="l l-Scalar l-Scalar-Plain">lxc.cgroup2.devices.allow = c 254:* rwm</span>
<a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="l l-Scalar l-Scalar-Plain">lxc.mount.entry = /dev/gpiochip0 dev/gpiochip0 none bind,optional,create=file</span>
</code></pre></div>
</li>
<li>
<p>Restart the LXC using the UI</p>
</li>
<li>Works!</li>
</ol>
<h3 id="passthrough-otg-port-for-keyboardmouse">Passthrough OTG Port for keyboard/mouse<a class="headerlink" href="#passthrough-otg-port-for-keyboardmouse" title="Permanent link">¶</a></h3>
<ol>
<li>
<p>Failure from <code>journalctl</code></p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a>Dec<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">04</span>:52:47<span class="w"> </span>pikvm<span class="w"> </span>systemd<span class="o">[</span><span class="m">1</span><span class="o">]</span>:<span class="w"> </span>Starting<span class="w"> </span>PiKVM<span class="w"> </span>-<span class="w"> </span>OTG<span class="w"> </span>setup...
<a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a>Dec<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">04</span>:52:48<span class="w"> </span>pikvm<span class="w"> </span>kvmd-otg<span class="o">[</span><span class="m">182</span><span class="o">]</span>:<span class="w"> </span>kvmd.apps.otg<span class="w">                     </span>INFO<span class="w"> </span>---<span class="w"> </span>Using<span class="w"> </span>UDC<span class="w"> </span>fe980000.usb
<a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a>Dec<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">04</span>:52:48<span class="w"> </span>pikvm<span class="w"> </span>kvmd-otg<span class="o">[</span><span class="m">182</span><span class="o">]</span>:<span class="w"> </span>kvmd.apps.otg<span class="w">                     </span>INFO<span class="w"> </span>---<span class="w"> </span>Creating<span class="w"> </span>gadget<span class="w"> </span><span class="s1">'kvmd'</span><span class="w"> </span>...
<a href="#__codelineno-13-4" id="__codelineno-13-4" name="__codelineno-13-4"></a>Dec<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">04</span>:52:48<span class="w"> </span>pikvm<span class="w"> </span>kvmd-otg<span class="o">[</span><span class="m">182</span><span class="o">]</span>:<span class="w"> </span>kvmd.apps.otg<span class="w">                     </span>INFO<span class="w"> </span>---<span class="w"> </span>MKDIR<span class="w"> </span>---<span class="w"> </span>/sys/kernel/config/usb_gadget/kvmd
<a href="#__codelineno-13-5" id="__codelineno-13-5" name="__codelineno-13-5"></a>Dec<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">04</span>:52:48<span class="w"> </span>pikvm<span class="w"> </span>kvmd-otg<span class="o">[</span><span class="m">182</span><span class="o">]</span>:<span class="w"> </span>Traceback<span class="w"> </span><span class="o">(</span>most<span class="w"> </span>recent<span class="w"> </span>call<span class="w"> </span>last<span class="o">)</span>:
<a href="#__codelineno-13-6" id="__codelineno-13-6" name="__codelineno-13-6"></a>Dec<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">04</span>:52:48<span class="w"> </span>pikvm<span class="w"> </span>kvmd-otg<span class="o">[</span><span class="m">182</span><span class="o">]</span>:<span class="w">   </span>File<span class="w"> </span><span class="s2">"/usr/bin/kvmd-otg"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">8</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>&lt;module&gt;
<a href="#__codelineno-13-7" id="__codelineno-13-7" name="__codelineno-13-7"></a>Dec<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">04</span>:52:48<span class="w"> </span>pikvm<span class="w"> </span>kvmd-otg<span class="o">[</span><span class="m">182</span><span class="o">]</span>:<span class="w">     </span>sys.exit<span class="o">(</span>main<span class="o">())</span>
<a href="#__codelineno-13-8" id="__codelineno-13-8" name="__codelineno-13-8"></a>Dec<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">04</span>:52:48<span class="w"> </span>pikvm<span class="w"> </span>kvmd-otg<span class="o">[</span><span class="m">182</span><span class="o">]</span>:<span class="w">   </span>File<span class="w"> </span><span class="s2">"/usr/lib/python3/dist-packages/kvmd/apps/otg/__init__.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">348</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>main
<a href="#__codelineno-13-9" id="__codelineno-13-9" name="__codelineno-13-9"></a>Dec<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">04</span>:52:48<span class="w"> </span>pikvm<span class="w"> </span>kvmd-otg<span class="o">[</span><span class="m">182</span><span class="o">]</span>:<span class="w">     </span>options.cmd<span class="o">(</span>config<span class="o">)</span>
<a href="#__codelineno-13-10" id="__codelineno-13-10" name="__codelineno-13-10"></a>Dec<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">04</span>:52:48<span class="w"> </span>pikvm<span class="w"> </span>kvmd-otg<span class="o">[</span><span class="m">182</span><span class="o">]</span>:<span class="w">   </span>File<span class="w"> </span><span class="s2">"/usr/lib/python3/dist-packages/kvmd/apps/otg/__init__.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">212</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>_cmd_start
<a href="#__codelineno-13-11" id="__codelineno-13-11" name="__codelineno-13-11"></a>Dec<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">04</span>:52:48<span class="w"> </span>pikvm<span class="w"> </span>kvmd-otg<span class="o">[</span><span class="m">182</span><span class="o">]</span>:<span class="w">     </span>_mkdir<span class="o">(</span>gadget_path<span class="o">)</span>
<a href="#__codelineno-13-12" id="__codelineno-13-12" name="__codelineno-13-12"></a>Dec<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">04</span>:52:48<span class="w"> </span>pikvm<span class="w"> </span>kvmd-otg<span class="o">[</span><span class="m">182</span><span class="o">]</span>:<span class="w">   </span>File<span class="w"> </span><span class="s2">"/usr/lib/python3/dist-packages/kvmd/apps/otg/__init__.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">50</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>_mkdir
<a href="#__codelineno-13-13" id="__codelineno-13-13" name="__codelineno-13-13"></a>Dec<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">04</span>:52:48<span class="w"> </span>pikvm<span class="w"> </span>kvmd-otg<span class="o">[</span><span class="m">182</span><span class="o">]</span>:<span class="w">     </span>os.mkdir<span class="o">(</span>path<span class="o">)</span>
<a href="#__codelineno-13-14" id="__codelineno-13-14" name="__codelineno-13-14"></a>Dec<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">04</span>:52:48<span class="w"> </span>pikvm<span class="w"> </span>kvmd-otg<span class="o">[</span><span class="m">182</span><span class="o">]</span>:<span class="w"> </span>FileNotFoundError:<span class="w"> </span><span class="o">[</span>Errno<span class="w"> </span><span class="m">2</span><span class="o">]</span><span class="w"> </span>No<span class="w"> </span>such<span class="w"> </span>file<span class="w"> </span>or<span class="w"> </span>directory:<span class="w"> </span><span class="s1">'/sys/kernel/config/usb_gadget/kvmd'</span>
</code></pre></div>
</li>
<li>
<p>Check which devices are expected from <code>kvmd -m</code></p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="nt">hid</span><span class="p">:</span>
<a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="w"> </span><span class="nt">keyboard</span><span class="p">:</span>
<a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="w">   </span><span class="nt">device</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dev/kvmd-hid-keyboard</span>
<a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a>
<a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w"> </span><span class="nt">mouse</span><span class="p">:</span>
<a href="#__codelineno-14-6" id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="w">   </span><span class="nt">device</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dev/kvmd-hid-mouse</span>
<a href="#__codelineno-14-7" id="__codelineno-14-7" name="__codelineno-14-7"></a>
<a href="#__codelineno-14-8" id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="w"> </span><span class="nt">mouse_alt</span><span class="p">:</span>
<a href="#__codelineno-14-9" id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="w">   </span><span class="nt">device</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dev/kvmd-hid-mouse-alt</span>
</code></pre></div>
</li>
<li>
<p>Ensure kernel module in the host <code>i2c-dev</code> is loaded</p>
</li>
<li>
<p>Mount <code>/sys/kernel/config</code> in LXC by updating the template</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="nt">lxc.mount.entry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/sys/kernel/config sys/kernel/config none bind,optional</span>
<a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="c1"># 236 is the major group of the hidg* devices</span>
<a href="#__codelineno-15-3" id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="nt">lxc.cgroup2.devices.allow</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">c 236:* rwm</span>
</code></pre></div>
</li>
<li>
<p>Once the <code>kvmd-otg</code> service starts the usb_gadget devices are created in the host, not in the guest</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a>crw-rw----<span class="w">  </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>kvmd<span class="w">    </span><span class="m">236</span>,<span class="w">   </span><span class="m">0</span><span class="w"> </span>Dec<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">15</span>:52<span class="w"> </span>hidg0
<a href="#__codelineno-16-2" id="__codelineno-16-2" name="__codelineno-16-2"></a>crw-rw----<span class="w">  </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>kvmd<span class="w">    </span><span class="m">236</span>,<span class="w">   </span><span class="m">1</span><span class="w"> </span>Dec<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">15</span>:52<span class="w"> </span>hidg1
<a href="#__codelineno-16-3" id="__codelineno-16-3" name="__codelineno-16-3"></a>crw-rw----<span class="w">  </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>kvmd<span class="w">    </span><span class="m">236</span>,<span class="w">   </span><span class="m">2</span><span class="w"> </span>Dec<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">15</span>:52<span class="w"> </span>hidg2
</code></pre></div>
</li>
<li>
<p>Now it’s a bit of a 🐔 and 🥚 situation, where we need the <code>/dev/hidg*</code> devices to exist on the host before starting the container. But once the container starts these devices are created on the host 😅. Therefore inside the LXC we need to add these devices manually</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a>mknod<span class="w"> </span>/dev/kvmd-hid-keyboard<span class="w"> </span>c<span class="w"> </span><span class="m">236</span><span class="w"> </span><span class="m">0</span>
<a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a>mknod<span class="w"> </span>/dev/kvmd-hid-mouse<span class="w"> </span>c<span class="w"> </span><span class="m">236</span><span class="w"> </span><span class="m">1</span>
<a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a>mknod<span class="w"> </span>/dev/kvmd-hid-mouse-alt<span class="w"> </span>c<span class="w"> </span><span class="m">236</span><span class="w"> </span><span class="m">2</span>
</code></pre></div>
</li>
<li>
<p>Ensure the permissions on these devices are correct so the kvmd group can control them</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a>chown<span class="w"> </span>root:kvmd<span class="w"> </span>/dev/kvmd-hid-keyboard<span class="w"> </span>/dev/kvmd-hid-mouse<span class="w"> </span>/dev/kvmd-hid-mouse-alt
<a href="#__codelineno-18-2" id="__codelineno-18-2" name="__codelineno-18-2"></a>chmod<span class="w"> </span><span class="m">0660</span><span class="w">  </span>/dev/kvmd-hid-keyboard<span class="w"> </span>/dev/kvmd-hid-mouse<span class="w"> </span>/dev/kvmd-hid-mouse-alt
</code></pre></div>
</li>
<li>
<p>Login to the web UI validate that the keyboard works! (Note the kvmd is attached to a server, so unable to test the mouse)</p>
</li>
</ol>
<h3 id="passthrough-hdmi-capture-card">Passthrough HDMI Capture Card<a class="headerlink" href="#passthrough-hdmi-capture-card" title="Permanent link">¶</a></h3>
<ol>
<li>
<p>Failure from <code>journalctl</code></p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a>Dec<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">05</span>:03:41<span class="w"> </span>pikvm<span class="w"> </span>systemd<span class="o">[</span><span class="m">1</span><span class="o">]</span>:<span class="w"> </span>Starting<span class="w"> </span>PiKVM<span class="w"> </span>-<span class="w"> </span>EDID<span class="w"> </span>loader<span class="w"> </span><span class="k">for</span><span class="w"> </span>TC358743...
<a href="#__codelineno-19-2" id="__codelineno-19-2" name="__codelineno-19-2"></a>Dec<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">05</span>:03:41<span class="w"> </span>pikvm<span class="w"> </span>v4l2-ctl<span class="o">[</span><span class="m">182</span><span class="o">]</span>:<span class="w"> </span>Cannot<span class="w"> </span>open<span class="w"> </span>device<span class="w"> </span>/dev/kvmd-video,<span class="w"> </span>exiting.
<a href="#__codelineno-19-3" id="__codelineno-19-3" name="__codelineno-19-3"></a>Dec<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">05</span>:03:41<span class="w"> </span>pikvm<span class="w"> </span>systemd<span class="o">[</span><span class="m">1</span><span class="o">]</span>:<span class="w"> </span>kvmd-tc358743.service:<span class="w"> </span>Main<span class="w"> </span>process<span class="w"> </span>exited,<span class="w"> </span><span class="nv">code</span><span class="o">=</span>exited,<span class="w"> </span><span class="nv">status</span><span class="o">=</span><span class="m">1</span>/FAILURE
<a href="#__codelineno-19-4" id="__codelineno-19-4" name="__codelineno-19-4"></a>Dec<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">05</span>:03:41<span class="w"> </span>pikvm<span class="w"> </span>systemd<span class="o">[</span><span class="m">1</span><span class="o">]</span>:<span class="w"> </span>kvmd-tc358743.service:<span class="w"> </span>Failed<span class="w"> </span>with<span class="w"> </span>result<span class="w"> </span><span class="s1">'exit-code'</span>.
<a href="#__codelineno-19-5" id="__codelineno-19-5" name="__codelineno-19-5"></a>Dec<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">05</span>:03:41<span class="w"> </span>pikvm<span class="w"> </span>systemd<span class="o">[</span><span class="m">1</span><span class="o">]</span>:<span class="w"> </span>Failed<span class="w"> </span>to<span class="w"> </span>start<span class="w"> </span>PiKVM<span class="w"> </span>-<span class="w"> </span>EDID<span class="w"> </span>loader<span class="w"> </span><span class="k">for</span><span class="w"> </span>TC358743.
</code></pre></div>
</li>
<li>
<p>The error message mentions the relevant device!</p>
</li>
<li>
<p>Update the LXC template</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="nt">lxc.cgroup2.devices.allow</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">c 81:* rwm</span>
<a href="#__codelineno-20-2" id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="nt">lxc.mount.entry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dev/video0 dev/kvmd-video none bind,optional,create=file</span>
</code></pre></div>
</li>
<li>
<p>Restart the LXC</p>
</li>
<li>
<p>Now we see a different error</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-21-1" id="__codelineno-21-1" name="__codelineno-21-1"></a>Dec<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">05</span>:32:21<span class="w"> </span>pikvm<span class="w"> </span>kvmd<span class="o">[</span><span class="m">237</span><span class="o">]</span>:<span class="w"> </span>kvmd.apps.kvmd.streamer<span class="w">           </span>INFO<span class="w"> </span>---<span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>--<span class="w"> </span>ERROR<span class="w"> </span><span class="o">[</span><span class="m">36989</span>.079<span class="w">          </span><span class="o">]</span><span class="w"> </span>--<span class="w"> </span>H264:<span class="w"> </span>Can<span class="w"> </span>t<span class="w"> </span>open<span class="w"> </span>encoder<span class="w"> </span>device:<span class="w"> </span>No<span class="w"> </span>such<span class="w"> </span>file<span class="w"> </span>or<span class="w"> </span>directory
<a href="#__codelineno-21-2" id="__codelineno-21-2" name="__codelineno-21-2"></a>Dec<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">05</span>:32:21<span class="w"> </span>pikvm<span class="w"> </span>kvmd<span class="o">[</span><span class="m">237</span><span class="o">]</span>:<span class="w"> </span>kvmd.apps.kvmd.streamer<span class="w">           </span>INFO<span class="w"> </span>---<span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>--<span class="w"> </span>ERROR<span class="w"> </span><span class="o">[</span><span class="m">36989</span>.079<span class="w">          </span><span class="o">]</span><span class="w"> </span>--<span class="w"> </span>H264:<span class="w"> </span>Encoder<span class="w"> </span>destroyed<span class="w"> </span>due<span class="w"> </span>an<span class="w"> </span>error<span class="w"> </span><span class="o">(</span>prepare<span class="o">)</span>
</code></pre></div>
</li>
<li>
<p>This is because the H264 encoder is a separate video device on the Raspberry Pi. I decided to simply passthrough all video devices, but there is probably a smarter way to go about this 🙈</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-22-1" id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="nt">lxc.cgroup2.devices.allow</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">c 81:* rwm</span>
<a href="#__codelineno-22-2" id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="nt">lxc.mount.entry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dev/video0  dev/kvmd-video none bind,optional,create=file</span>
<a href="#__codelineno-22-3" id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="nt">lxc.mount.entry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dev/video10 dev/video10 none bind,optional,create=file</span>
<a href="#__codelineno-22-4" id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="nt">lxc.mount.entry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dev/video11 dev/video11 none bind,optional,create=file</span>
<a href="#__codelineno-22-5" id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="nt">lxc.mount.entry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dev/video12 dev/video12 none bind,optional,create=file</span>
<a href="#__codelineno-22-6" id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="nt">lxc.mount.entry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dev/video13 dev/video13 none bind,optional,create=file</span>
<a href="#__codelineno-22-7" id="__codelineno-22-7" name="__codelineno-22-7"></a><span class="nt">lxc.mount.entry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dev/video14 dev/video14 none bind,optional,create=file</span>
<a href="#__codelineno-22-8" id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="nt">lxc.mount.entry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dev/video15 dev/video15 none bind,optional,create=file</span>
<a href="#__codelineno-22-9" id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="nt">lxc.mount.entry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dev/video16 dev/video16 none bind,optional,create=file</span>
<a href="#__codelineno-22-10" id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="nt">lxc.mount.entry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dev/video18 dev/video18 none bind,optional,create=file</span>
<a href="#__codelineno-22-11" id="__codelineno-22-11" name="__codelineno-22-11"></a><span class="nt">lxc.mount.entry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dev/video19 dev/video19 none bind,optional,create=file</span>
<a href="#__codelineno-22-12" id="__codelineno-22-12" name="__codelineno-22-12"></a><span class="nt">lxc.mount.entry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dev/video20 dev/video20 none bind,optional,create=file</span>
<a href="#__codelineno-22-13" id="__codelineno-22-13" name="__codelineno-22-13"></a><span class="nt">lxc.mount.entry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dev/video21 dev/video21 none bind,optional,create=file</span>
<a href="#__codelineno-22-14" id="__codelineno-22-14" name="__codelineno-22-14"></a><span class="nt">lxc.mount.entry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dev/video22 dev/video22 none bind,optional,create=file</span>
<a href="#__codelineno-22-15" id="__codelineno-22-15" name="__codelineno-22-15"></a><span class="nt">lxc.mount.entry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dev/video23 dev/video23 none bind,optional,create=file</span>
<a href="#__codelineno-22-16" id="__codelineno-22-16" name="__codelineno-22-16"></a><span class="nt">lxc.mount.entry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dev/video31 dev/video31 none bind,optional,create=file</span>
</code></pre></div>
</li>
<li>
<p>Restart the LXC</p>
</li>
<li>Navigate to the web UI and validate it works 🎉</li>
</ol>
<h3 id="passthrough-i2c-for-the-oled-screen">Passthrough I2C for the OLED Screen<a class="headerlink" href="#passthrough-i2c-for-the-oled-screen" title="Permanent link">¶</a></h3>
<ol>
<li><code>journalctl</code> and <code>systemctl</code> didn’t show the <code>kvmd-oled</code> service</li>
<li>
<p>Running <code>systemctl start kvmd-oled</code> showed the problem, the device <code>/dev/i2c-1</code> didn’t exist</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-23-1" id="__codelineno-23-1" name="__codelineno-23-1"></a>Jan<span class="w"> </span><span class="m">08</span><span class="w"> </span><span class="m">09</span>:14:13<span class="w"> </span>pikvm<span class="w"> </span>systemd<span class="o">[</span><span class="m">1</span><span class="o">]</span>:<span class="w"> </span>PiKVM<span class="w"> </span>-<span class="w"> </span>A<span class="w"> </span>small<span class="w"> </span>OLED<span class="w"> </span>daemon<span class="w"> </span>was<span class="w"> </span>skipped<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>an<span class="w"> </span>unmet<span class="w"> </span>condition<span class="w"> </span>check<span class="w"> </span><span class="o">(</span><span class="nv">ConditionPathExists</span><span class="o">=</span>/dev/i2c-1<span class="o">)</span>.
</code></pre></div>
</li>
<li>
<p>Easy peasy 🍋! Update the LXC template</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-24-1" id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="nt">lxc.cgroup2.devices.allow</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">c 89:* rwm</span>
<a href="#__codelineno-24-2" id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="nt">lxc.mount.entry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dev/i2c-1 dev/i2c-1 none bind,optional,create=file 0 0</span>
</code></pre></div>
</li>
<li>
<p>Restart the LXC</p>
</li>
<li>BOOM<br/>
<img alt="pikvm-oled-screen.png" loading="lazy" src="../../images/pikvm-oled-screen.png"/></li>
</ol>
<h3 id="incus-kvmd-armbian-lxc-container-with-passthrough">Incus Kvmd-armbian LXC Container with Passthrough<a class="headerlink" href="#incus-kvmd-armbian-lxc-container-with-passthrough" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-25-1" id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="c1"># create pikvm container using ubuntu/jammy as the base as mentioned in the kvmd-armbian repository</span>
<a href="#__codelineno-25-2" id="__codelineno-25-2" name="__codelineno-25-2"></a>incus<span class="w"> </span>init<span class="w"> </span>images:ubuntu/jammy<span class="w"> </span>kvmd
<a href="#__codelineno-25-3" id="__codelineno-25-3" name="__codelineno-25-3"></a>
<a href="#__codelineno-25-4" id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="c1"># Passthrough all the video devices for hdmi video capture and hardware decoing of H264. Using uid/gid 999 here as that's the id of kvmd inside the LXC container.</span>
<a href="#__codelineno-25-5" id="__codelineno-25-5" name="__codelineno-25-5"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>kvmd<span class="w"> </span>kvmd-video<span class="w"> </span>unix-char<span class="w">  </span><span class="nv">path</span><span class="o">=</span>/dev/kvmd-video<span class="w"> </span><span class="nv">source</span><span class="o">=</span>/dev/video0<span class="w">   </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">999</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">999</span>
<a href="#__codelineno-25-6" id="__codelineno-25-6" name="__codelineno-25-6"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>kvmd<span class="w"> </span>video10<span class="w"> </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/video10<span class="w"> </span><span class="nv">source</span><span class="o">=</span>/dev/video10<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">999</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">999</span>
<a href="#__codelineno-25-7" id="__codelineno-25-7" name="__codelineno-25-7"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>kvmd<span class="w"> </span>video11<span class="w"> </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/video11<span class="w"> </span><span class="nv">source</span><span class="o">=</span>/dev/video11<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">999</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">999</span>
<a href="#__codelineno-25-8" id="__codelineno-25-8" name="__codelineno-25-8"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>kvmd<span class="w"> </span>video12<span class="w"> </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/video12<span class="w"> </span><span class="nv">source</span><span class="o">=</span>/dev/video12<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">999</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">999</span>
<a href="#__codelineno-25-9" id="__codelineno-25-9" name="__codelineno-25-9"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>kvmd<span class="w"> </span>video13<span class="w"> </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/video13<span class="w"> </span><span class="nv">source</span><span class="o">=</span>/dev/video13<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">999</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">999</span>
<a href="#__codelineno-25-10" id="__codelineno-25-10" name="__codelineno-25-10"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>kvmd<span class="w"> </span>video14<span class="w"> </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/video14<span class="w"> </span><span class="nv">source</span><span class="o">=</span>/dev/video14<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">999</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">999</span>
<a href="#__codelineno-25-11" id="__codelineno-25-11" name="__codelineno-25-11"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>kvmd<span class="w"> </span>video15<span class="w"> </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/video15<span class="w"> </span><span class="nv">source</span><span class="o">=</span>/dev/video15<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">999</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">999</span>
<a href="#__codelineno-25-12" id="__codelineno-25-12" name="__codelineno-25-12"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>kvmd<span class="w"> </span>video16<span class="w"> </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/video16<span class="w"> </span><span class="nv">source</span><span class="o">=</span>/dev/video16<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">999</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">999</span>
<a href="#__codelineno-25-13" id="__codelineno-25-13" name="__codelineno-25-13"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>kvmd<span class="w"> </span>video18<span class="w"> </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/video18<span class="w"> </span><span class="nv">source</span><span class="o">=</span>/dev/video18<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">999</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">999</span>
<a href="#__codelineno-25-14" id="__codelineno-25-14" name="__codelineno-25-14"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>kvmd<span class="w"> </span>video19<span class="w"> </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/video19<span class="w"> </span><span class="nv">source</span><span class="o">=</span>/dev/video19<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">999</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">999</span>
<a href="#__codelineno-25-15" id="__codelineno-25-15" name="__codelineno-25-15"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>kvmd<span class="w"> </span>video20<span class="w"> </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/video20<span class="w"> </span><span class="nv">source</span><span class="o">=</span>/dev/video20<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">999</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">999</span>
<a href="#__codelineno-25-16" id="__codelineno-25-16" name="__codelineno-25-16"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>kvmd<span class="w"> </span>video21<span class="w"> </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/video21<span class="w"> </span><span class="nv">source</span><span class="o">=</span>/dev/video21<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">999</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">999</span>
<a href="#__codelineno-25-17" id="__codelineno-25-17" name="__codelineno-25-17"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>kvmd<span class="w"> </span>video22<span class="w"> </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/video22<span class="w"> </span><span class="nv">source</span><span class="o">=</span>/dev/video22<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">999</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">999</span>
<a href="#__codelineno-25-18" id="__codelineno-25-18" name="__codelineno-25-18"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>kvmd<span class="w"> </span>video23<span class="w"> </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/video23<span class="w"> </span><span class="nv">source</span><span class="o">=</span>/dev/video23<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">999</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">999</span>
<a href="#__codelineno-25-19" id="__codelineno-25-19" name="__codelineno-25-19"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>kvmd<span class="w"> </span>video31<span class="w"> </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/video31<span class="w"> </span><span class="nv">source</span><span class="o">=</span>/dev/video31<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">999</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">999</span>
<a href="#__codelineno-25-20" id="__codelineno-25-20" name="__codelineno-25-20"></a>
<a href="#__codelineno-25-21" id="__codelineno-25-21" name="__codelineno-25-21"></a><span class="c1"># Passthrough the gpiochip0 to enable ATX control</span>
<a href="#__codelineno-25-22" id="__codelineno-25-22" name="__codelineno-25-22"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>kvmd<span class="w"> </span>gpiochip0<span class="w"> </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/gpiochip0<span class="w"> </span><span class="nv">source</span><span class="o">=</span>/dev/gpiochip0<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">999</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">999</span>
<a href="#__codelineno-25-23" id="__codelineno-25-23" name="__codelineno-25-23"></a>
<a href="#__codelineno-25-24" id="__codelineno-25-24" name="__codelineno-25-24"></a><span class="c1"># Make sure to disable apparmor so we get read/write access to sys</span>
<a href="#__codelineno-25-25" id="__codelineno-25-25" name="__codelineno-25-25"></a>incus<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>kvmd<span class="w"> </span>raw.lxc<span class="w"> </span><span class="s2">"lxc.apparmor.profile=unconfined"</span>
<a href="#__codelineno-25-26" id="__codelineno-25-26" name="__codelineno-25-26"></a>
<a href="#__codelineno-25-27" id="__codelineno-25-27" name="__codelineno-25-27"></a><span class="c1"># Add the /sys/kernel/config directory as a mount to enable the guest to create usb devices in the host to enable otg based keyboard/mouse emulation.</span>
<a href="#__codelineno-25-28" id="__codelineno-25-28" name="__codelineno-25-28"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>kvmd<span class="w"> </span>sys-kernel<span class="w"> </span>disk<span class="w"> </span><span class="nv">source</span><span class="o">=</span>/sys/kernel/config<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/sys/kernel/config<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span>
<a href="#__codelineno-25-29" id="__codelineno-25-29" name="__codelineno-25-29"></a>
<a href="#__codelineno-25-30" id="__codelineno-25-30" name="__codelineno-25-30"></a><span class="c1"># We passthrough the hidgX devices from the host to the guest when they appear. The guest first needs to boot and create the usb_gadget devices before the /dev/hidgX devices appear in the host therefore the devices are marked as "required=false". Once the device appears it's hotplugged and added to the guest.</span>
<a href="#__codelineno-25-31" id="__codelineno-25-31" name="__codelineno-25-31"></a><span class="c1"># See https://linuxcontainers.org/incus/docs/main/reference/devices_unix_char/</span>
<a href="#__codelineno-25-32" id="__codelineno-25-32" name="__codelineno-25-32"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>kvmd<span class="w"> </span>hidg0<span class="w"> </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/kvmd-hid-keyboard<span class="w"> </span><span class="nv">source</span><span class="o">=</span>/dev/hidg0<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">999</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">999</span>
<a href="#__codelineno-25-33" id="__codelineno-25-33" name="__codelineno-25-33"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>kvmd<span class="w"> </span>hidg1<span class="w"> </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/kvmd-hid-mouse<span class="w"> </span><span class="nv">source</span><span class="o">=</span>/dev/hidg1<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">999</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">999</span>
<a href="#__codelineno-25-34" id="__codelineno-25-34" name="__codelineno-25-34"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>kvmd<span class="w"> </span>hidg2<span class="w"> </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/kvmd-hid-mouse-alt<span class="w"> </span><span class="nv">source</span><span class="o">=</span>/dev/hidg2<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">999</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">999</span>
<a href="#__codelineno-25-35" id="__codelineno-25-35" name="__codelineno-25-35"></a>
<a href="#__codelineno-25-36" id="__codelineno-25-36" name="__codelineno-25-36"></a><span class="c1"># We passthrough the i2c-1 device to enable access to the OLED device</span>
<a href="#__codelineno-25-37" id="__codelineno-25-37" name="__codelineno-25-37"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>kvmd<span class="w"> </span>i2c-1<span class="w"> </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/i2c-1<span class="w"> </span><span class="nv">source</span><span class="o">=</span>/dev/i2c-1<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">999</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">999</span>
</code></pre></div>
<h3 id="incus-pikvm-lxc-container-with-passthrough">Incus PiKVM LXC Container with Passthrough<a class="headerlink" href="#incus-pikvm-lxc-container-with-passthrough" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-26-1" id="__codelineno-26-1" name="__codelineno-26-1"></a>incus<span class="w"> </span>init<span class="w"> </span>provisioner:pikvm-rpi4/latest<span class="w"> </span>pikvm
<a href="#__codelineno-26-2" id="__codelineno-26-2" name="__codelineno-26-2"></a>
<a href="#__codelineno-26-3" id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="c1"># Make sure to disable apparmor and enable privileged container so we get read/write access to sys</span>
<a href="#__codelineno-26-4" id="__codelineno-26-4" name="__codelineno-26-4"></a>incus<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>pikvm<span class="w"> </span>raw.lxc<span class="w"> </span><span class="s2">"lxc.apparmor.profile=unconfined"</span>
<a href="#__codelineno-26-5" id="__codelineno-26-5" name="__codelineno-26-5"></a>incus<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>pikvm<span class="w"> </span>security.privileged<span class="w"> </span><span class="nb">true</span>
<a href="#__codelineno-26-6" id="__codelineno-26-6" name="__codelineno-26-6"></a>
<a href="#__codelineno-26-7" id="__codelineno-26-7" name="__codelineno-26-7"></a><span class="c1"># boot the instance at startup</span>
<a href="#__codelineno-26-8" id="__codelineno-26-8" name="__codelineno-26-8"></a>incus<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>pikvm<span class="w"> </span>boot.autorestart<span class="w"> </span><span class="nb">true</span>
<a href="#__codelineno-26-9" id="__codelineno-26-9" name="__codelineno-26-9"></a>incus<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>pikvm<span class="w"> </span>boot.autostart<span class="w"> </span><span class="nb">true</span>
<a href="#__codelineno-26-10" id="__codelineno-26-10" name="__codelineno-26-10"></a>
<a href="#__codelineno-26-11" id="__codelineno-26-11" name="__codelineno-26-11"></a><span class="c1"># Passthrough all the video devices for hdmi video capture and hardware decoing of H264</span>
<a href="#__codelineno-26-12" id="__codelineno-26-12" name="__codelineno-26-12"></a><span class="c1"># Note I'm using gid/uid 968 instead of 999 because the user and group ids of kvmd are different in the official image!</span>
<a href="#__codelineno-26-13" id="__codelineno-26-13" name="__codelineno-26-13"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>pikvm<span class="w"> </span>kvmd-video<span class="w"> </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/kvmd-video<span class="w"> </span><span class="nv">source</span><span class="o">=</span>/dev/video0<span class="w">  </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">968</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">968</span>
<a href="#__codelineno-26-14" id="__codelineno-26-14" name="__codelineno-26-14"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>pikvm<span class="w"> </span>video10<span class="w">    </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/video10<span class="w">    </span><span class="nv">source</span><span class="o">=</span>/dev/video10<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">968</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">968</span>
<a href="#__codelineno-26-15" id="__codelineno-26-15" name="__codelineno-26-15"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>pikvm<span class="w"> </span>video11<span class="w">    </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/video11<span class="w">    </span><span class="nv">source</span><span class="o">=</span>/dev/video11<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">968</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">968</span>
<a href="#__codelineno-26-16" id="__codelineno-26-16" name="__codelineno-26-16"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>pikvm<span class="w"> </span>video12<span class="w">    </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/video12<span class="w">    </span><span class="nv">source</span><span class="o">=</span>/dev/video12<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">968</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">968</span>
<a href="#__codelineno-26-17" id="__codelineno-26-17" name="__codelineno-26-17"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>pikvm<span class="w"> </span>video13<span class="w">    </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/video13<span class="w">    </span><span class="nv">source</span><span class="o">=</span>/dev/video13<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">968</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">968</span>
<a href="#__codelineno-26-18" id="__codelineno-26-18" name="__codelineno-26-18"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>pikvm<span class="w"> </span>video14<span class="w">    </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/video14<span class="w">    </span><span class="nv">source</span><span class="o">=</span>/dev/video14<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">968</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">968</span>
<a href="#__codelineno-26-19" id="__codelineno-26-19" name="__codelineno-26-19"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>pikvm<span class="w"> </span>video15<span class="w">    </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/video15<span class="w">    </span><span class="nv">source</span><span class="o">=</span>/dev/video15<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">968</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">968</span>
<a href="#__codelineno-26-20" id="__codelineno-26-20" name="__codelineno-26-20"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>pikvm<span class="w"> </span>video16<span class="w">    </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/video16<span class="w">    </span><span class="nv">source</span><span class="o">=</span>/dev/video16<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">968</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">968</span>
<a href="#__codelineno-26-21" id="__codelineno-26-21" name="__codelineno-26-21"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>pikvm<span class="w"> </span>video18<span class="w">    </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/video18<span class="w">    </span><span class="nv">source</span><span class="o">=</span>/dev/video18<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">968</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">968</span>
<a href="#__codelineno-26-22" id="__codelineno-26-22" name="__codelineno-26-22"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>pikvm<span class="w"> </span>video19<span class="w">    </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/video19<span class="w">    </span><span class="nv">source</span><span class="o">=</span>/dev/video19<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">968</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">968</span>
<a href="#__codelineno-26-23" id="__codelineno-26-23" name="__codelineno-26-23"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>pikvm<span class="w"> </span>video20<span class="w">    </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/video20<span class="w">    </span><span class="nv">source</span><span class="o">=</span>/dev/video20<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">968</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">968</span>
<a href="#__codelineno-26-24" id="__codelineno-26-24" name="__codelineno-26-24"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>pikvm<span class="w"> </span>video21<span class="w">    </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/video21<span class="w">    </span><span class="nv">source</span><span class="o">=</span>/dev/video21<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">968</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">968</span>
<a href="#__codelineno-26-25" id="__codelineno-26-25" name="__codelineno-26-25"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>pikvm<span class="w"> </span>video22<span class="w">    </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/video22<span class="w">    </span><span class="nv">source</span><span class="o">=</span>/dev/video22<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">968</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">968</span>
<a href="#__codelineno-26-26" id="__codelineno-26-26" name="__codelineno-26-26"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>pikvm<span class="w"> </span>video23<span class="w">    </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/video23<span class="w">    </span><span class="nv">source</span><span class="o">=</span>/dev/video23<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">968</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">968</span>
<a href="#__codelineno-26-27" id="__codelineno-26-27" name="__codelineno-26-27"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>pikvm<span class="w"> </span>video31<span class="w">    </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/video31<span class="w">    </span><span class="nv">source</span><span class="o">=</span>/dev/video31<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">968</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">968</span>
<a href="#__codelineno-26-28" id="__codelineno-26-28" name="__codelineno-26-28"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>pikvm<span class="w"> </span>vcio<span class="w">    </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/vcio<span class="w">    </span><span class="nv">source</span><span class="o">=</span>/dev/vcio<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">968</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">968</span>
<a href="#__codelineno-26-29" id="__codelineno-26-29" name="__codelineno-26-29"></a>
<a href="#__codelineno-26-30" id="__codelineno-26-30" name="__codelineno-26-30"></a>
<a href="#__codelineno-26-31" id="__codelineno-26-31" name="__codelineno-26-31"></a><span class="c1"># Passthrough the gpiochip0 to enable ATX control</span>
<a href="#__codelineno-26-32" id="__codelineno-26-32" name="__codelineno-26-32"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>pikvm<span class="w"> </span>gpiochip0<span class="w"> </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/gpiochip0<span class="w"> </span><span class="nv">source</span><span class="o">=</span>/dev/gpiochip0<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">968</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">968</span>
<a href="#__codelineno-26-33" id="__codelineno-26-33" name="__codelineno-26-33"></a>
<a href="#__codelineno-26-34" id="__codelineno-26-34" name="__codelineno-26-34"></a><span class="c1"># Add the /sys/kernel/config directory as a mount to enable the guest to create usb devices in the host to enable otg based keyboard/mouse emulation.</span>
<a href="#__codelineno-26-35" id="__codelineno-26-35" name="__codelineno-26-35"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>pikvm<span class="w"> </span>sys-kernel<span class="w"> </span>disk<span class="w"> </span><span class="nv">source</span><span class="o">=</span>/sys/kernel/config<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/sys/kernel/config<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span>
<a href="#__codelineno-26-36" id="__codelineno-26-36" name="__codelineno-26-36"></a>
<a href="#__codelineno-26-37" id="__codelineno-26-37" name="__codelineno-26-37"></a><span class="c1"># We passthrough the hidgX devices from the host to the guest when they appear. The guest first needs to boot and create the usb_gadget devices before the /dev/hidgX devices appear in the host therefore the devices are marked as "required=false". Once the device appears it's hotplugged and added to the guest.</span>
<a href="#__codelineno-26-38" id="__codelineno-26-38" name="__codelineno-26-38"></a><span class="c1"># See https://linuxcontainers.org/incus/docs/main/reference/devices_unix_char/</span>
<a href="#__codelineno-26-39" id="__codelineno-26-39" name="__codelineno-26-39"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>pikvm<span class="w"> </span>hidg0<span class="w"> </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/kvmd-hid-keyboard<span class="w">  </span><span class="nv">source</span><span class="o">=</span>/dev/hidg0<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">968</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">968</span>
<a href="#__codelineno-26-40" id="__codelineno-26-40" name="__codelineno-26-40"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>pikvm<span class="w"> </span>hidg1<span class="w"> </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/kvmd-hid-mouse<span class="w">     </span><span class="nv">source</span><span class="o">=</span>/dev/hidg1<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">968</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">968</span>
<a href="#__codelineno-26-41" id="__codelineno-26-41" name="__codelineno-26-41"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>pikvm<span class="w"> </span>hidg2<span class="w"> </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/kvmd-hid-mouse-alt<span class="w"> </span><span class="nv">source</span><span class="o">=</span>/dev/hidg2<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">968</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">968</span>
<a href="#__codelineno-26-42" id="__codelineno-26-42" name="__codelineno-26-42"></a>
<a href="#__codelineno-26-43" id="__codelineno-26-43" name="__codelineno-26-43"></a><span class="c1"># We passthrough the i2c-1 device to enable access to the OLED device</span>
<a href="#__codelineno-26-44" id="__codelineno-26-44" name="__codelineno-26-44"></a>incus<span class="w"> </span>config<span class="w"> </span>device<span class="w"> </span>add<span class="w"> </span>pikvm<span class="w"> </span>i2c-1<span class="w"> </span>unix-char<span class="w"> </span><span class="nv">path</span><span class="o">=</span>/dev/i2c-1<span class="w"> </span><span class="nv">source</span><span class="o">=</span>/dev/i2c-1<span class="w"> </span><span class="nv">required</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">968</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">968</span>
<a href="#__codelineno-26-45" id="__codelineno-26-45" name="__codelineno-26-45"></a>
<a href="#__codelineno-26-46" id="__codelineno-26-46" name="__codelineno-26-46"></a>incus<span class="w"> </span>start<span class="w"> </span>pikvm
</code></pre></div>
</article>
</div>
<script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<div class="md-progress" data-md-component="progress" role="progressbar"></div>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tracking", "navigation.top", "navigation.sections", "navigation.indexes", "navigation.instant", "navigation.instant.progress", "search.suggest", "search.highlight", "search.share", "content.action.edit", "content.action.view", "content.code.copy", "content.code.annotate", "content.tabs.link", "toc.follow"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
</body>
</html>