{
  "name": "onepassword-addon-xp",
  "version": "0.1.0",
  "private": false,
  "nx": {
    "projectType": "library",
    "sourceRoot": "libs/onepassword-addon-xp",
    "targets": {
      "pull-helm-chart": {
        "executor": "nx:run-commands",
        "options": {
          "commands": [
            "mkdir -p libs/onepassword-addon-xp/helm",
            "tar -czf libs/onepassword-addon-xp/helm/connect-2.0.3.tgz -C third_party/vendir/charts/1password-connect ."
          ],
          "parallel": false
        },
        "outputs": [
          "{projectRoot}/helm/connect-2.0.3.tgz"
        ],
        "inputs": [
          "third_party/vendir/charts/1password-connect/**/*"
        ],
        "cache": true,
        "metadata": {
          "description": "Package vendored 1Password Helm chart"
        }
      },
      "build": {
        "executor": "nx:run-commands",
        "options": {
          "commands": [
            "test -d libs/onepassword-addon-xp/tests && mv libs/onepassword-addon-xp/tests /tmp/onepassword-addon-xp-tests-backup || true",
            "test -d libs/onepassword-addon-xp/kubeconfig && mv libs/onepassword-addon-xp/kubeconfig /tmp/onepassword-addon-xp-kubeconfig-backup || true",
            "mkdir -p libs/onepassword-addon-xp/dist",
            "cd libs/onepassword-addon-xp && up xpkg build -f . -o dist/onepassword-addon-xp.xpkg",
            "test -d /tmp/onepassword-addon-xp-tests-backup && mv /tmp/onepassword-addon-xp-tests-backup libs/onepassword-addon-xp/tests || true",
            "test -d /tmp/onepassword-addon-xp-kubeconfig-backup && mv /tmp/onepassword-addon-xp-kubeconfig-backup libs/onepassword-addon-xp/kubeconfig || true"
          ],
          "parallel": false
        },
        "outputs": [
          "{projectRoot}/dist"
        ],
        "inputs": [
          "{projectRoot}/crossplane.yaml",
          "{projectRoot}/crds/**/*",
          "{projectRoot}/helm/**/*.tgz"
        ],
        "dependsOn": [
          "pull-helm-chart"
        ],
        "cache": true,
        "metadata": {
          "description": "Build Crossplane AddOn package"
        }
      },
      "test": {
        "executor": "nx:run-commands",
        "options": {
          "commands": [
            "kind create cluster --name onepassword-test --config libs/onepassword-addon-xp/tests/kind-config.yaml",
            "helm repo add crossplane-stable https://charts.crossplane.io/stable",
            "helm repo update",
            "helm install crossplane crossplane-stable/crossplane --namespace crossplane-system --create-namespace --wait",
            "kuttl test --config libs/onepassword-addon-xp/tests/kuttl-test.yaml",
            "kind delete cluster --name onepassword-test"
          ],
          "parallel": false,
          "cwd": "."
        },
        "cache": true,
        "metadata": {
          "description": "Run kuttl e2e tests in kind cluster"
        }
      }
    },
    "tags": [
      "crossplane",
      "onepassword",
      "kubernetes",
      "secrets",
      "skip-ci"
    ]
  }
}
