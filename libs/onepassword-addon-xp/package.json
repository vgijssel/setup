{
  "name": "onepassword-addon-xp",
  "version": "0.1.0",
  "private": false,
  "nx": {
    "projectType": "library",
    "sourceRoot": "libs/onepassword-addon-xp",
    "targets": {
      "pull-helm-chart": {
        "executor": "nx:run-commands",
        "options": {
          "commands": [
            "mkdir -p libs/onepassword-addon-xp/helm",
            "helm repo add 1password https://1password.github.io/connect-helm-charts || true",
            "helm repo update 1password || true",
            "helm pull 1password/connect --version 2.0.5 --destination /tmp --untar",
            "tar -czf libs/onepassword-addon-xp/helm/connect-2.0.5.tgz -C /tmp/connect .",
            "rm -rf /tmp/connect"
          ],
          "parallel": false
        },
        "outputs": [
          "{projectRoot}/helm/connect-2.0.5.tgz"
        ],
        "cache": true,
        "metadata": {
          "description": "Pull and package 1Password Helm chart"
        }
      },
      "build": {
        "executor": "nx:run-commands",
        "options": {
          "commands": [
            "mv libs/onepassword-addon-xp/tests /tmp/onepassword-addon-xp-tests-backup || true",
            "mv libs/onepassword-addon-xp/kubeconfig /tmp/onepassword-addon-xp-kubeconfig-backup || true",
            "cd libs/onepassword-addon-xp && up xpkg build -f . -o dist/onepassword-addon-xp.xpkg",
            "mv /tmp/onepassword-addon-xp-tests-backup libs/onepassword-addon-xp/tests || true",
            "mv /tmp/onepassword-addon-xp-kubeconfig-backup libs/onepassword-addon-xp/kubeconfig || true"
          ],
          "parallel": false
        },
        "outputs": [
          "{projectRoot}/dist"
        ],
        "inputs": [
          "{projectRoot}/crossplane.yaml",
          "{projectRoot}/crds/**/*",
          "{projectRoot}/helm/**/*.tgz"
        ],
        "dependsOn": [
          "pull-helm-chart"
        ],
        "cache": true,
        "metadata": {
          "description": "Build Crossplane AddOn package"
        }
      },
      "test": {
        "executor": "nx:run-commands",
        "options": {
          "commands": [
            "kind create cluster --name onepassword-test --config libs/onepassword-addon-xp/tests/kind-config.yaml || true",
            "helm repo add crossplane-stable https://charts.crossplane.io/stable || true",
            "helm repo update || true",
            "helm install crossplane crossplane-stable/crossplane --namespace crossplane-system --create-namespace --wait || true",
            "kuttl test --config libs/onepassword-addon-xp/tests/kuttl-test.yaml",
            "kind delete cluster --name onepassword-test || true"
          ],
          "parallel": false,
          "cwd": "."
        },
        "cache": true,
        "metadata": {
          "description": "Run kuttl e2e tests in kind cluster"
        }
      }
    },
    "tags": [
      "crossplane",
      "onepassword",
      "kubernetes",
      "secrets"
    ]
  }
}
