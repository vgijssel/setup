apiVersion: kuttl.dev/v1beta1
kind: TestStep
metadata:
  name: collect-dns-service-ip
spec:
  commands:
  - command: |
      DNS_SERVICE_IP=$(kubectl get service internal-dns-test -o jsonpath='{.status.loadBalancer.ingress[0].ip}')
      echo "DNS Service IP: $DNS_SERVICE_IP"
      if [ -z "$DNS_SERVICE_IP" ]; then
        echo "Failed to get DNS service IP"
        exit 1
      fi
      echo "$DNS_SERVICE_IP" > /tmp/dns-service-ip.txt
    namespaced: true