# Relay server configuration
# Production-ready defaults with health checks, resource limits, and file descriptor configuration

# Name - used to generate resource names; set to unique value when deploying multiple instances
name: relay-server
# Optional: Override the full resource name (takes precedence over name)
fullnameOverride: ""

replicaCount: 1

image:
  repository: docker.system3.md/relay-server
  pullPolicy: IfNotPresent
  tag: v0.9.2
  pullSecrets: []

# Resource limits and requests
# Adjust based on expected load; family instances may need higher limits
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

# File descriptor limits (ulimits)
# Critical for stability under load - prevents crashes when too many files are opened
# Note: Standard Kubernetes doesn't support ulimits via securityContext.
# These values are documented for reference; actual implementation requires:
# - Container runtime configuration (Docker/containerd)
# - Or init container approach (see PRD for examples)
# - Or node-level sysctl configuration
ulimits:
  nofile:
    soft: 1024
    hard: 1024

# Liveness probe - checks if server is responsive
# Default: TCP probe (relay server doesn't expose HTTP /health endpoint)
# Note: relay-server is a WebSocket server, use TCP socket probe
livenessProbe:
  tcpSocket:
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

# Readiness probe - checks if server is ready to accept traffic
# Default: TCP probe (relay server doesn't expose HTTP /ready endpoint)
# Note: relay-server is a WebSocket server, use TCP socket probe
readinessProbe:
  tcpSocket:
    port: http
  initialDelaySeconds: 5
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

# Service configuration
service:
  type: LoadBalancer
  port: 80
  targetPort: 8080
  annotations: {}

# Environment variables for relay server
env:
  # Public URL for your service
  relayServerUrl: ""
  # Storage backend (s3)
  relayServerStorage: s3
  # AWS region
  awsRegion: us-east-1
  # Custom S3 endpoint (for non-AWS S3-compatible services)
  awsEndpointUrlS3: ""
  # Use path-style URLs for S3
  awsS3UsePathStyle: "false"
  # S3 bucket name
  awsBucket: ""

# Secret reference for AWS credentials
# The chart expects a Kubernetes Secret with AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY
secretReference:
  name: ""
  keys:
    awsAccessKeyId: AWS_ACCESS_KEY_ID
    awsSecretAccessKey: AWS_SECRET_ACCESS_KEY
