# Namespace where LINSTOR controller runs
linstorNamespace: cozy-linstor

# Node selector label for LINSTOR satellites
nodeSelector:
  key: linstor.storage
  value: enabled

# Storage network configuration
storageNetwork:
  enabled: true
  configVersion: v8

  # Node definitions with their storage interfaces
  nodes:
    illusion:
      interfaces:
        - name: storage-dome
          ip: 10.50.1.0
        - name: storage-toyfactory
          ip: 10.50.2.1
    the-dome:
      interfaces:
        - name: storage-illusion
          ip: 10.50.1.1
        - name: storage-toyfactory
          ip: 10.50.3.0
    the-toy-factory:
      interfaces:
        - name: storage-illusion
          ip: 10.50.2.0
        - name: storage-dome
          ip: 10.50.3.1

  # Node connection paths (point-to-point links)
  connections:
    - nodeA: illusion
      nodeB: the-dome
      pathName: direct
      interfaceA: storage-dome
      interfaceB: storage-illusion
    - nodeA: illusion
      nodeB: the-toy-factory
      pathName: direct
      interfaceA: storage-toyfactory
      interfaceB: storage-illusion
    - nodeA: the-dome
      nodeB: the-toy-factory
      pathName: direct
      interfaceA: storage-toyfactory
      interfaceB: storage-dome

# DRBD options for 25Gbps point-to-point network
# Scaled from cozystack 10Gbps reference: https://cozystack.io/docs/storage/drbd-tuning/
# 25Gbps theoretical = 3,125 MB/s; practical (~80%) = 2,500 MB/s
drbdOptions:
  # c-max-rate: Maximum resync rate in KiB/s
  # 10Gbps reference: 737,280 KiB/s (720 MiB/s)
  # 25Gbps scaled (2.5x): ~1,843,200 KiB/s, using 2,048,000 KiB/s (~2 GB/s)
  cMaxRate: "2048000"
  # c-min-rate: Minimum resync rate (~1/3 of c-max-rate per LINBIT recommendation)
  # Ensures resync doesn't completely starve during I/O load
  cMinRate: "682666"
  # resync-rate: Starting point for dynamic rate controller (same as c-min-rate)
  resyncRate: "682666"
  # c-plan-ahead: Lookahead window in deciseconds (10 = 1 second)
  # 10Gbps reference: 10; keeping same for stability
  cPlanAhead: "10"
  # c-fill-target: Buffer fill target in KiB
  # 10Gbps reference: 2,048; scaled 2.5x = 5,120 KiB
  cFillTarget: "5120"
  # max-buffers: Network buffer count
  # 10Gbps reference: 36,864; scaled 2.5x = 92,160
  maxBuffers: "92160"
  # sndbuf-size/rcvbuf-size: Socket buffer sizes in bytes
  # LINSTOR hard maximum: 10,485,760 bytes (10 MiB) - cannot exceed this
  sndbufSize: "10485760"
  rcvbufSize: "10485760"

# Job configuration
job:
  image: registry.k8s.io/kubectl:v1.32.1
  ttlSecondsAfterFinished: 3600
  backoffLimit: 5

# StorageClass configurations
storageClasses:
  localSsd:
    enabled: true
    name: local-ssd
    isDefault: true
    storagePool: ssd
  replicated:
    enabled: true
    name: replicated
    storagePool: ssd
    autoPlace: "3"
