# Virtual Ingress Helm Chart Values
# ----------------------------------
# This chart creates Kyverno policies that resolve label-based service selectors
# in Ingress resources. Instead of specifying a service name directly, you can
# use matchLabels to dynamically resolve the service at runtime.
#
# Example use case: Kubevirt CCM service mirroring where services are created
# with dynamic names but consistent labels like:
#   - cluster.x-k8s.io/cluster-name: kubernetes-cluster-docs-infra-prod
#   - cluster.x-k8s.io/tenant-service-name: relay-family

# Kyverno namespace configuration
# The namespace where Kyverno controllers are running
kyvernoNamespace: kyverno

# Service discovery configuration
serviceDiscovery:
  # How to handle when no service matches the provided labels
  # Options:
  #   - error: Block ingress creation with a clear error message (default)
  #   - warn: Create ingress with a warning annotation
  #   - ignore: Skip silently without generating
  noMatchBehavior: error

  # How to handle when multiple services match the provided labels
  # Options:
  #   - error: Block ingress creation with a message listing matching services (default)
  #   - first: Proceed with the first matching service (alphabetically by name)
  multipleMatchBehavior: error

  # Default namespace for service discovery
  # If empty, uses the same namespace as the source ingress
  # If set, looks for services in this specific namespace
  defaultNamespace: ""

# Generated ingress configuration
generatedIngress:
  # Suffix to append to generated ingress name
  # The generated ingress will be named: <source-ingress-name><suffix>
  nameSuffix: -resolved

  # Additional labels to add to generated ingresses
  # These are merged with labels copied from the source ingress
  additionalLabels: {}
    # example-label: example-value

  # Additional annotations to add to generated ingresses
  # These are merged with annotations copied from the source ingress
  # WebSocket-specific annotations from the source are preserved automatically
  additionalAnnotations: {}
    # example-annotation: example-value

# Policy configuration
policy:
  # Whether to process existing ingresses when policy is created
  # If true, Kyverno will scan existing ingresses and generate resolved versions
  generateExisting: true

  # Enable background scanning
  # When true, Kyverno will periodically re-evaluate ingresses to detect
  # service changes (e.g., when a service is recreated with a new name)
  backgroundScan: true

  # Synchronize generated resources with source
  # When true, changes to the source ingress are automatically propagated
  # to the generated ingress, and deletion of source triggers cleanup
  synchronize: true
