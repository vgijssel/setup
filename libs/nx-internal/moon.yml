language: javascript
layer: library
tasks:
  package_test:
    command: npm install && git diff --exit-code package-lock.json
    env:
      CWD: "."
    inputs:
      - glob: /**/package.json
        cache: true
      - glob: /**/package-lock.json
        cache: true
    options:
      cache: true
    toolchain: system
  release_plan_test:
    command: nx release plan:check
    env:
      CWD: "."
    toolchain: system
  release_publish_test:
    command: nx release publish --dry-run
    env:
      CWD: "."
    inputs:
      - glob: /**/package.json
        cache: true
      - glob: /**/package-lock.json
        cache: true
      - file: /nx.json
      - glob: /.nx/version-plans/*.md
        cache: true
    options:
      cache: true
    toolchain: system
  release_test:
    command: nx release --dry-run
    env:
      CWD: "."
    inputs:
      - glob: /**/package.json
        cache: true
      - glob: /**/package-lock.json
        cache: true
      - file: /nx.json
      - glob: /.nx/version-plans/*.md
        cache: true
    options:
      cache: true
    toolchain: system
  test:
    command: noop
    deps:
      - ~:release_plan_test
      - ~:release_test
      - ~:package_test
      - ~:release_publish_test
toolchain:
  default: node
