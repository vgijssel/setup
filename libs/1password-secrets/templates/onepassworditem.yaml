{{- $systemNamespaces := list "flux-system" "kube-system" -}}
{{- $namespaces := dict -}}
{{- range .Values.secrets }}
  {{- if not (has .namespace $systemNamespaces) }}
    {{- $_ := set $namespaces .namespace true }}
  {{- end }}
{{- end }}
{{- range $namespace, $_ := $namespaces }}
---
apiVersion: v1
kind: Namespace
metadata:
  name: {{ $namespace }}
{{- end }}
{{- range .Values.secrets }}
---
apiVersion: onepassword.com/v1
kind: OnePasswordItem
metadata:
  name: {{ .name }}
  namespace: {{ .namespace }}
spec:
  itemPath: {{ .itemPath }}
{{- end }}
