language: javascript
layer: library
dependsOn:
  - devcontainer-install-extensions
tags:
  - devenv
  - chezmoi
  - development-environment
  - macos
  - devenv
  - chezmoi
  - development-environment
  - macos
tasks:
  apply:
    command: chezmoi-wrapper apply --verbose
    deps:
      - devcontainer-install-extensions:build
    local: true

  test:
    script: chezmoi-wrapper apply --force --verbose && goss validate
    deps:
      - claude-code:build
      - vendir:build
      - devcontainer-install-extensions:build
    inputs:
      - glob: files/**/*
        cache: true
      - file: goss.yaml
      - file: chezmoi.yaml
      - file: /.chezmoiroot
      - "@globs(chezmoi_bin)"
    options:
      cache: true
