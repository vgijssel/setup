#!/usr/bin/env bash
set -euo pipefail

{{- $setup_dir := env "SETUP_DIR" }}
{{- $devcontainer_file := joinPath $setup_dir ".devcontainer" "devcontainer.json" }}
{{- $devcontainer := include $devcontainer_file | fromJson }}

VSCODE_EXT_DIR="${HOME}/.vscode-server/extensions"
CODE_SERVER_EXT_DIR="${HOME}/.local/share/code-server/extensions"

echo "ðŸ“¦ Installing VSCode extensions from {{ $devcontainer_file }}"

mkdir -p "${VSCODE_EXT_DIR}" "${CODE_SERVER_EXT_DIR}"

{{ range $devcontainer.customizations.vscode.extensions -}}
echo "Installing extension: {{ . }}"

# Install for VSCode (remote server)
if ! code-server-internal --accept-server-license-terms --extensions-dir "${VSCODE_EXT_DIR}" --install-extension "{{ . }}"; then
  echo "âŒ Failed to install {{ . }} for VSCode" >&2
  exit 1
fi
echo "âœ“ Successfully installed {{ . }} for VSCode"

{{ end -}}
echo "âœ… VSCode extensions installed successfully"
