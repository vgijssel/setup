language: javascript
layer: library
tags:
  - python
  - cli
  - cloudflare
  - dns
  - external-dns
  - uv-script
  - python
  - cli
  - cloudflare
  - dns
  - external-dns
  - uv-script
tasks:
  start:
    command: ./external-dns-cleanup
    deps:
      - ~:secrets
    env:
      CWD: libs/external-dns-cleanup
    local: true
  secrets:
    command: op inject --force -i .env.tpl -o .env
    env:
      CWD: libs/external-dns-cleanup
    inputs:
      - file: .env.tpl
    outputs:
      - .env
    options:
      cache: true
  test:
    command: uv run --all-extras pytest -v
    deps:
      - ~:secrets
    env:
      CWD: libs/external-dns-cleanup
    inputs:
      - glob: "**/*.*"
        cache: true
      - glob: "!.pytest_cache/**"
        cache: true
      - glob: "!.venv/**"
        cache: true
      - glob: "!.env"
        cache: true
    local: true
    options:
      cache: true
