# Pi-hole Docker Compose Configuration
# Managed by Ansible - DO NOT EDIT MANUALLY
# Deployed to: {{ pihole_compose_dir }}/docker-compose.yml

services:
  pihole-vlan50:
    container_name: {{ pihole_vlan50_container_name }}
    image: {{ pihole_docker_image }}
    hostname: {{ pihole_vlan50_container_name }}
    networks:
      vlan50:
        ipv4_address: {{ pihole_vlan50_ip }}
    environment:
      TZ: '{{ pihole_timezone }}'
      WEBPASSWORD: '{{ pihole_web_password }}'
      PIHOLE_DNS_: '{{ pihole_upstream_dns }}'
      DNSMASQ_LISTENING: 'all'
      VIRTUAL_HOST: '{{ pihole_vlan50_container_name }}.local'
      FTLCONF_LOCAL_IPV4: '{{ pihole_vlan50_ip }}'
    volumes:
      - '{{ pihole_vlan50_data_dir }}/etc-pihole:/etc/pihole'
      - '{{ pihole_vlan50_data_dir }}/etc-dnsmasq.d:/etc/dnsmasq.d'
    cap_add:
      - NET_ADMIN
    restart: unless-stopped
    dns:
      - 127.0.0.1
      - {{ pihole_upstream_dns }}

  pihole-admin:
    container_name: {{ pihole_admin_container_name }}
    image: {{ pihole_docker_image }}
    hostname: {{ pihole_admin_container_name }}
    networks:
      admin:
        ipv4_address: {{ pihole_admin_ip }}
    environment:
      TZ: '{{ pihole_timezone }}'
      WEBPASSWORD: '{{ pihole_web_password }}'
      PIHOLE_DNS_: '{{ pihole_upstream_dns }}'
      DNSMASQ_LISTENING: 'all'
      VIRTUAL_HOST: '{{ pihole_admin_container_name }}.local'
      FTLCONF_LOCAL_IPV4: '{{ pihole_admin_ip }}'
    volumes:
      - '{{ pihole_admin_data_dir }}/etc-pihole:/etc/pihole'
      - '{{ pihole_admin_data_dir }}/etc-dnsmasq.d:/etc/dnsmasq.d'
    cap_add:
      - NET_ADMIN
    restart: unless-stopped
    dns:
      - 127.0.0.1
      - {{ pihole_upstream_dns }}

networks:
  vlan50:
    driver: macvlan
    driver_opts:
      parent: {{ pihole_vlan50_parent_interface }}
    ipam:
      config:
        - subnet: {{ pihole_vlan50_subnet }}
          gateway: {{ pihole_vlan50_gateway }}
          ip_range: {{ pihole_vlan50_ip }}/32

  admin:
    driver: macvlan
    driver_opts:
      parent: {{ pihole_admin_parent_interface }}
    ipam:
      config:
        - subnet: {{ pihole_admin_subnet }}
          gateway: {{ pihole_admin_gateway }}
          ip_range: {{ pihole_admin_ip }}/32
