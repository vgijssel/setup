language: javascript
layer: library
tags:
  - cloudflare
  - tunnel
  - opentofu
  - infrastructure
  - cloudflare
  - tunnel
  - opentofu
  - infrastructure
tasks:
  init:
    command: tofu init
    env:
      CWD: libs/cloudflare-tunnel
    outputs:
      - ".terraform"
      - ".terraform.lock.hcl"
    options:
      cache: true
    toolchain: system
  secrets:
    command: op inject --force -i terraform.tfvars.tpl -o terraform.tfvars
    env:
      CWD: libs/cloudflare-tunnel
    inputs:
      - file: terraform.tfvars.tpl
    outputs:
      - terraform.tfvars
    options:
      cache: true
    toolchain: system
  test:
    command: tofu test
    deps:
      - ~:init
      - ~:secrets
    env:
      CWD: libs/cloudflare-tunnel
    options:
      cache: true
    toolchain: system
  validate:
    command: tofu validate
    deps:
      - ~:init
    env:
      CWD: libs/cloudflare-tunnel
    options:
      cache: true
    toolchain: system
toolchain:
  default: node
