apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: cloudflare-tunnels.tunnel.crossplane.io
  labels: {{- include "cloudflare-tunnel.labels" . | nindent 4 }}
spec:
  group: tunnel.crossplane.io
  scope: Namespaced
  names:
    kind: CloudflareTunnel
    plural: cloudflare-tunnels
  versions:
  - name: v1
    served: true
    storage: true
    schema:
      openAPIV3Schema:
        type: object
        properties:
          spec:
            type: object
            properties:
              parameters:
                type: object
                properties:
                  image:
                    type: object
                    properties:
                      registry:
                        type: string
                        default: "docker.io"
                      repository:
                        type: string
                        default: "cloudflare/cloudflared"
                      tag:
                        type: string
                        default: "2025.8.1"
                      pullPolicy:
                        type: string
                        default: "IfNotPresent"
                    required:
                      - registry
                      - repository
                      - tag
                      - pullPolicy
                  tunnel:
                    type: object
                    properties:
                      zone:
                        type: string
                        description: "Cloudflare zone name"
                      name:
                        type: string
                        description: "Cloudflare tunnel name"
                      service:
                        type: string
                        description: "Service URL for the tunnel"
                    required:
                      - zone
                      - name
                      - service
                  secrets:
                    type: object
                    properties:
                      tunnelToken:
                        type: object
                        properties:
                          name:
                            type: string
                            default: "cloudflare-tunnel-token"
                          key:
                            type: string
                            default: "credential"
                        required:
                          - name
                          - key
                    required:
                      - tunnelToken
                required:
                  - image
                  - tunnel
                  - secrets
          status:
            type: object
            properties:
              tunnelId:
                type: string
                description: "The ID of the created Cloudflare tunnel"
              ready:
                type: boolean
                description: "Whether the tunnel is ready"