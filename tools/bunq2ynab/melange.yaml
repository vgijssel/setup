package:
  name: kerk_package
  version: 0.0.1
  epoch: 0
  description: "kerk package"
  target-architecture:
    - all
    # - arm64
    # - arm64
  copyright:
    - paths:
        - "*"
      attestation: TODO
      license: BSD-2-Clause
  dependencies:
    runtime:
      - python3

environment:
  contents:
    repositories:
      - https://dl-cdn.alpinelinux.org/alpine/edge/main
    packages:
      - alpine-baselayout-data
      - busybox
      # - build-base
      # - scanelf
      # - ssl_client
      # - ca-certificates-bundle
      # - brotli-dev
      # - gd-dev
      # - geoip-dev
      # - libmaxminddb-dev
      # - libxml2-dev
      # - libxslt-dev
      # - linux-headers
      # - openssl3-dev
      # - pcre-dev
      # - pkgconf
      # - zeromq-dev
      # - zlib-dev

  # accounts:
  #   groups:
  #     - groupname: nginx
  #       gid: 10000
  #   users:
  #     - username: nginx
  #       uid: 10000

vars:
  # variable needs to be relative to melange execution
  # as melange starts a docker container with a volume mount in the directory it's running
  kerk_tar: kerk_tar.tar

pipeline:
  - name: debug
    runs: pwd
  - name: debug
    runs: ls -la
  - name: "Create kerk_package dir"
    runs: mkdir -p ${{targets.destdir}}/opt/${{package.name}}
  - name: "Untar the kerk_tar file into the kerk_package dir"
    runs: tar -xvf ${{vars.kerk_tar}} -C ${{targets.destdir}}/opt/${{package.name}}
