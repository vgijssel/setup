load("//tools/command:command.bzl", "command")

package(default_visibility = ["//visibility:public"])

terraform_files = select({
    "@platforms//cpu:aarch64": ["@terraform_arm64//:files"],
    "@platforms//cpu:x86_64": ["@terraform_amd64//:files"],
})

sh_binary(
    name = "terraform_binary",
    srcs = terraform_files,
)

command(
    name = "terraform",
    command_src = ":terraform_binary",
    cwd = "{{ os.environ.get('BUILD_WORKSPACE_DIRECTORY', os.getcwd()) }}",
)
