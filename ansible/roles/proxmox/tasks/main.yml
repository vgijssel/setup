- name: Set the hostname in the hosts file
  ansible.builtin.lineinfile:
    path: /etc/hosts
    line: "{{ hostvars[ansible_host].ansible_all_ipv4_addresses.0 }} {{ hostvars[ansible_host].ansible_fqdn }} {{ hostvars[ansible_host].ansible_hostname }}"
    regexp: "{{ hostvars[ansible_host].ansible_fqdn }}"
  become: true

- name: Update kernel parameters to bootable
  ansible.builtin.copy:
    src: cmdline.txt
    dest: /boot/firmware/cmdline.txt
    owner: root
    group: root
    mode: "0755"
  register: kernel_params_result
  become: true

- name: reboot
  ansible.builtin.reboot:
  when: kernel_params_result.changed
  become: true
