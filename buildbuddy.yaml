actions:
  - name: "Test all targets"
    user: buildbuddy
    container_image: "ubuntu-20.04"
    triggers:
      push:
        branches:
          - "master"
      pull_request:
        branches:
          - "*"
    bazel_commands:
      - "test //... @rules_task//... --config buildbuddy --config buildbuddy_rbe"

  - name: "Deploy Provisioner"
    user: buildbuddy
    container_image: "ubuntu-20.04"
    triggers:
      push:
        branches:
          - "reserved-for-buildbuddy-api__deploy-provisioner"
    bazel_commands:
      - "run //provisioner:deploy --config buildbuddy --config buildbuddy_rbe"

  - name: "Validate Provisioner"
    user: buildbuddy
    container_image: "ubuntu-20.04"
    triggers:
      push:
        branches:
          - "reserved-for-buildbuddy-api__validate-provisioner"
    bazel_commands:
      - "run //provisioner:deploy_validate --config buildbuddy --config buildbuddy_rbe"

  - name: "Test Env"
    user: buildbuddy
    container_image: "ubuntu-20.04"
    triggers:
      pull_request:
        branches:
          - "*"
    bazel_commands:
      - "run //provisioner:deploy_mark"
