name: "Setup Bazel"
description: "Setup the CI to work properly with Bazel"
inputs:
runs:
  using: "composite"
  steps:
    - uses: pat-s/always-upload-cache@v3.0.11
      id: bazel-cache
      with:
        path: |
          tmp/output_base/external
        key: bazel-cache-${{ runner.os }}-${{ github.job }}-${{ github.sha }}
        restore-keys: bazel-cache-${{ runner.os }}-${{ github.job }}-

    - name: Install nix package manager
      uses: cachix/install-nix-action@v22
      with:
        nix_path: nixpkgs=channel:nixos-23.11

    - name: Create local.bazelrc file
      shell: bash
      run: |
        echo "startup --output_base=$(pwd)/tmp/output_base" >> local.bazelrc
        cat local.bazelrc
