platform: gpio
on_press:
    then:
      - if:
          condition:
            and:
              - wifi.connected:
              - api.connected:
              - switch.is_on: shelly_relay
          # toggle smart light if wifi and api are connected and relay is on
          then:
            - homeassistant.service:
                service: light.toggle
                data:
                  entity_id: ${light_entity_id}
          # else, toggle relay
          else:
            - switch.toggle: shelly_relay
filters:
  - delayed_on_off: 50ms