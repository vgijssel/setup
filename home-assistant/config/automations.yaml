- id: '1654117678356'
  alias: 'Office - Presence: Manage'
  description: ''
  trigger:
  - type: present
    platform: device
    device_id: 410ace0a782a03a250764603cd0c065e
    entity_id: binary_sensor.office_human_presence
    domain: binary_sensor
    for:
      hours: 0
      minutes: 0
      seconds: 30
  - platform: state
    entity_id:
    - binary_sensor.office_door_contact
    - binary_sensor.office_shelly_input
  - type: motion
    platform: device
    device_id: f454d32984b16796fb074bd7ba162ef3
    entity_id: binary_sensor.motion_sensor_home_security_motion_detection
    domain: binary_sensor
  condition: []
  action:
  - service: input_boolean.turn_on
    data: {}
    target:
      entity_id: input_boolean.office_presence
  - delay:
      hours: 0
      minutes: 1
      seconds: 0
      milliseconds: 0
  - if:
    - type: is_present
      condition: device
      device_id: 410ace0a782a03a250764603cd0c065e
      entity_id: binary_sensor.office_human_presence
      domain: binary_sensor
    then:
    - wait_for_trigger:
      - type: not_present
        platform: device
        device_id: 410ace0a782a03a250764603cd0c065e
        entity_id: binary_sensor.office_human_presence
        domain: binary_sensor
  - if:
    - type: is_motion
      condition: device
      device_id: f454d32984b16796fb074bd7ba162ef3
      entity_id: binary_sensor.motion_sensor_home_security_motion_detection
      domain: binary_sensor
    then:
    - wait_for_trigger:
      - type: no_motion
        platform: device
        device_id: f454d32984b16796fb074bd7ba162ef3
        entity_id: binary_sensor.motion_sensor_home_security_motion_detection
        domain: binary_sensor
  - service: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.office_presence
  mode: restart
- id: '1654118627011'
  alias: 'Office - Light: Manage'
  description: ''
  trigger:
  - platform: state
    entity_id:
    - input_boolean.office_presence
    to: 'on'
    from: 'off'
  condition: []
  action:
  - type: turn_on
    device_id: 882cfcb14e97e1a10ee2bb413e104af2
    entity_id: switch.office_shelly
    domain: switch
  - wait_for_trigger:
    - platform: state
      entity_id:
      - input_boolean.office_presence
      from: 'on'
      to: 'off'
  - type: turn_off
    device_id: 882cfcb14e97e1a10ee2bb413e104af2
    entity_id: switch.office_shelly
    domain: switch
  mode: single
- id: '1654167850551'
  alias: 'Supply Closet - Light: Manage'
  description: ''
  trigger:
  - platform: state
    entity_id:
    - input_boolean.supply_closet_presence
    from: 'off'
    to: 'on'
  condition: []
  action:
  - type: turn_on
    device_id: 4fdcffe73d9aa250e26599761c1a19dd
    entity_id: switch.supply_closet_shelly
    domain: switch
  - wait_for_trigger:
    - platform: state
      entity_id:
      - input_boolean.supply_closet_presence
      from: 'on'
      to: 'off'
  - type: turn_off
    device_id: 4fdcffe73d9aa250e26599761c1a19dd
    entity_id: switch.supply_closet_shelly
    domain: switch
  mode: single
- id: '1654670650990'
  alias: 'Living Room - Lights: Manual Toggle'
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.living_room_shelly_input
  condition: []
  action:
  - if:
    - condition: state
      entity_id: light.living_room_lights
      state: 'on'
    then:
    - service: light.turn_off
      data:
        transition: 1
      target:
        entity_id: light.living_room_lights
    else:
    - service: scene.turn_on
      data:
        transition: 2
      target:
        entity_id: scene.living_room_relax
  mode: single
- id: '1654679985339'
  alias: 'Laundry Room - Light: Manage'
  description: ''
  trigger:
  - type: motion
    platform: device
    device_id: 7167d9efd803b681e222837ae47e8d26
    entity_id: binary_sensor.laundry_room_motion_occupancy
    domain: binary_sensor
  condition: []
  action:
  - type: turn_on
    device_id: b0fbe5b3c69086de8cb4d79adaddbcb4
    entity_id: switch.laundry_room_shelly
    domain: switch
  - wait_for_trigger:
    - type: no_motion
      platform: device
      device_id: 7167d9efd803b681e222837ae47e8d26
      entity_id: binary_sensor.laundry_room_motion_occupancy
      domain: binary_sensor
      for:
        hours: 0
        minutes: 1
        seconds: 0
  - type: turn_off
    device_id: b0fbe5b3c69086de8cb4d79adaddbcb4
    entity_id: switch.laundry_room_shelly
    domain: switch
  mode: single
- id: '1654712522580'
  alias: 'Toilet - Light: Manage'
  description: ''
  trigger:
  - type: opened
    platform: device
    device_id: 243f5eeff7217b81ac1756571be041c6
    entity_id: binary_sensor.toilet_door_contact
    domain: binary_sensor
  condition: []
  action:
  - type: turn_on
    device_id: 30d480fafab423619f5acb1a5830427b
    entity_id: switch.toilet_shelly
    domain: switch
  - delay:
      hours: 0
      minutes: 4
      seconds: 0
      milliseconds: 0
  - type: turn_off
    device_id: 30d480fafab423619f5acb1a5830427b
    entity_id: switch.toilet_shelly
    domain: switch
  mode: single
- id: '1654715898803'
  alias: 'Driveway Light: Manage'
  description: ''
  trigger:
  - platform: state
    entity_id:
    - input_boolean.driveway_presence
    from: 'off'
    to: 'on'
  - platform: sun
    event: sunset
    offset: -02:00:00
  condition:
  - condition: state
    entity_id: input_boolean.driveway_presence
    state: 'on'
  - condition: sun
    after: sunset
    after_offset: -02:00:00
  action:
  - type: turn_on
    device_id: e3d2ffd411b04836211a50deafe94855
    entity_id: switch.driveway_shelly
    domain: switch
  - wait_for_trigger:
    - platform: state
      entity_id:
      - input_boolean.driveway_presence
      from: 'on'
      to: 'off'
  - type: turn_off
    device_id: e3d2ffd411b04836211a50deafe94855
    entity_id: switch.driveway_shelly
    domain: switch
  mode: single
- id: '1654888062741'
  alias: 'Living Room - Watching: Manage'
  description: ''
  trigger:
  - platform: device
    device_id: e9121935f1d5a2f516790f9a116fa1f0
    domain: media_player
    entity_id: media_player.living_room_tv
    type: playing
    for:
      hours: 0
      minutes: 0
      seconds: 15
  condition:
  - condition: or
    conditions:
    - condition: state
      entity_id: media_player.living_room_tv
      attribute: app_name
      state: Netflix
    - condition: state
      entity_id: media_player.living_room_tv
      attribute: app_name
      state: Prime Video
  action:
  - service: light.turn_on
    data:
      transition: 5
      brightness_pct: 30
      color_temp: 500
    target:
      area_id: living_room
  - wait_for_trigger:
    - platform: device
      device_id: e9121935f1d5a2f516790f9a116fa1f0
      domain: media_player
      entity_id: media_player.living_room_tv
      type: paused
    - platform: device
      type: turned_off
      device_id: e9121935f1d5a2f516790f9a116fa1f0
      entity_id: remote.living_room_tv
      domain: remote
    - platform: device
      device_id: e9121935f1d5a2f516790f9a116fa1f0
      domain: media_player
      entity_id: media_player.living_room_tv
      type: idle
  - service: light.turn_on
    data:
      transition: 2
      color_temp: 380
      brightness_pct: 90
    target:
      area_id: living_room
  mode: single
- id: '1654888687153'
  alias: 'Hallway - Presence: Manage'
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.living_room_door_contact
    - binary_sensor.hallway_door_contact
    - binary_sensor.toilet_door_contact
    - binary_sensor.hallway_shelly_input
  condition: []
  action:
  - service: input_boolean.turn_on
    data: {}
    target:
      entity_id: input_boolean.hallway_presence
  - delay:
      hours: 0
      minutes: 3
      seconds: 0
      milliseconds: 0
  - service: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.hallway_presence
  mode: restart
- id: '1655193271561'
  alias: 'Hallway - Light: Manage'
  description: ''
  trigger:
  - platform: state
    entity_id:
    - input_boolean.hallway_presence
    to: 'on'
    from: 'off'
  condition: []
  action:
  - type: turn_on
    device_id: 7f77499815c8499f7cf2c3d9d98b7704
    entity_id: switch.hallway_shelly
    domain: switch
  - wait_for_trigger:
    - platform: state
      entity_id:
      - input_boolean.hallway_presence
      from: 'on'
      to: 'off'
  - type: turn_off
    device_id: 7f77499815c8499f7cf2c3d9d98b7704
    entity_id: switch.hallway_shelly
    domain: switch
  mode: single
- id: '1655195807606'
  alias: 'Living Room - Presence: Manage'
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.living_room_door_contact
    - binary_sensor.supply_closet_door_contact
    - binary_sensor.living_room_shelly_input
  - type: present
    platform: device
    device_id: 9cbd44ac2a55c0ec041314b1300bdcd2
    entity_id: binary_sensor.living_room_tv_human_presence
    domain: binary_sensor
  - type: present
    platform: device
    device_id: 521cfeb78b6ecf75d853e911fb7eb27a
    entity_id: binary_sensor.living_room_dining_table_human_presence
    domain: binary_sensor
  condition: []
  action:
  - service: input_boolean.turn_on
    data: {}
    target:
      entity_id: input_boolean.living_room_presence
  - delay:
      hours: 0
      minutes: 2
      seconds: 0
      milliseconds: 0
  - if:
    - type: is_present
      condition: device
      device_id: 9cbd44ac2a55c0ec041314b1300bdcd2
      entity_id: binary_sensor.living_room_tv_human_presence
      domain: binary_sensor
    then:
    - wait_for_trigger:
      - type: not_present
        platform: device
        device_id: 9cbd44ac2a55c0ec041314b1300bdcd2
        entity_id: binary_sensor.living_room_tv_human_presence
        domain: binary_sensor
  - if:
    - type: is_present
      condition: device
      device_id: 521cfeb78b6ecf75d853e911fb7eb27a
      entity_id: binary_sensor.living_room_dining_table_human_presence
      domain: binary_sensor
    then:
    - wait_for_trigger:
      - type: not_present
        platform: device
        device_id: 521cfeb78b6ecf75d853e911fb7eb27a
        entity_id: binary_sensor.living_room_dining_table_human_presence
        domain: binary_sensor
  - service: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.living_room_presence
  mode: restart
- id: '1655195999380'
  alias: 'Living Room - Lights: Auto Manage'
  description: ''
  trigger:
  - platform: state
    entity_id:
    - input_boolean.living_room_presence
    from: 'off'
    to: 'on'
  condition: []
  action:
  - service: light.turn_on
    data:
      color_temp: 153
      brightness_pct: 100
    target:
      entity_id: light.living_room_tv_light
  - wait_for_trigger:
    - platform: state
      entity_id:
      - input_boolean.living_room_presence
      from: 'on'
      to: 'off'
  - service: light.turn_off
    data: {}
    target:
      entity_id: light.living_room_tv_light
  mode: single
- id: '1655205269031'
  alias: 'Driveway - Presence: Manage'
  description: ''
  trigger:
  - type: opened
    platform: device
    device_id: bd26b76a9ab0198a9e6ce3cee2daa483
    entity_id: binary_sensor.hallway_door_contact
    domain: binary_sensor
  condition: []
  action:
  - service: input_boolean.turn_on
    data: {}
    target:
      entity_id: input_boolean.driveway_presence
  - wait_for_trigger:
    - type: not_opened
      platform: device
      device_id: bd26b76a9ab0198a9e6ce3cee2daa483
      entity_id: binary_sensor.hallway_door_contact
      domain: binary_sensor
  - delay:
      hours: 0
      minutes: 2
      seconds: 0
      milliseconds: 0
  - service: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.driveway_presence
  mode: restart
- id: '1655211931964'
  alias: 'Supply Closet - Presence: Manage'
  description: ''
  trigger:
  - type: opened
    platform: device
    device_id: b6cb6e3ec0d8a1a3851cd6eae977b3c6
    entity_id: binary_sensor.supply_closet_door_contact
    domain: binary_sensor
  condition: []
  action:
  - service: input_boolean.turn_on
    data: {}
    target:
      entity_id: input_boolean.supply_closet_presence
  - wait_for_trigger:
    - type: not_opened
      platform: device
      device_id: b6cb6e3ec0d8a1a3851cd6eae977b3c6
      entity_id: binary_sensor.supply_closet_door_contact
      domain: binary_sensor
    timeout: 00:30:00
  - service: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.supply_closet_presence
  mode: restart
