export SETUP_DIR=$(pwd)
export SETUP_BIN_DIR=$SETUP_DIR/bin
export STACKS_DIR=$SETUP_DIR/stacks
export TMP_DIR=$SETUP_DIR/tmp
export SERVICES_DIR=$SETUP_DIR/services
export THIRD_PARTY_DIR=$SETUP_DIR/third_party
export VAULT_LOGIN_SECRETS_DIR=$SETUP_DIR/tmp/secrets
export VAULT_SECRETS_DIR=$SETUP_DIR/tmp/secrets

export PYTHONPATH=$SETUP_DIR

export GOSS_USE_ALPHA=1

# OS detection for conditional tests
if [[ "$(uname -s)" == "Darwin" ]]; then
    export IS_MACOS=true
    export IS_LINUX=false
    export IS_LINUX_HOST=false
    export IS_LINUX_CONTAINER=false
elif [[ "$(uname -s)" == "Linux" ]]; then
    export IS_MACOS=false
    export IS_LINUX=true
    # Check if running inside a Linux container (Docker, Podman, etc.)
    if [[ -f /.dockerenv ]] || [[ -f /run/.containerenv ]] || grep -qE '/docker/|/lxc/|/containerd/' /proc/1/cgroup 2>/dev/null; then
        export IS_LINUX_HOST=false
        export IS_LINUX_CONTAINER=true
    else
        export IS_LINUX_HOST=true
        export IS_LINUX_CONTAINER=false
    fi
else
    export IS_MACOS=false
    export IS_LINUX=false
    export IS_LINUX_HOST=false
    export IS_LINUX_CONTAINER=false
fi

# vault-shell secrets are in /secrets/{vault} (namespace-isolated tmpfs)
export TALOSCONFIG=/secrets/enigma-cozy/talosconfig

# AWS settings
export AWS_CONFIG_FILE=$SETUP_DIR/aws_profiles
export AWS_REGION=us-west-2

# Claude Code settings
export TRUNK_TELEMETRY=off
export DISABLE_TELEMETRY=1
export DISABLE_AUTOUPDATER=1

# Coder settings
export CODER_ACCESS_URL=https://macbook-pro-van-maarten.tail2c33e2.ts.net

# Necessary to share fleet-mcp as a public app
export CODER_DANGEROUS_ALLOW_PATH_APP_SHARING=true
export CODER_DANGEROUS_ALLOW_PATH_APP_SITE_OWNER_ACCESS=true
export CODER_MAX_TOKEN_LIFETIME=876600h0m0s
export CODER_MAX_ADMIN_TOKEN_LIFETIME=876600h0m0s

# Hermit settings. Set to 3 minutes to avoid timeout in devcontainer tests
export HERMIT_LOCK_TIMEOUT=180s

# Task Master settings
export TASK_MASTER_TOOLS=all
export TASKMASTER_SKIP_AUTO_UPDATE=1

export MOON_TOOLCHAIN_FORCE_GLOBALS=true

# Local Docker registry settings
export SETUP_REGISTRY_NAME="setup-local-registry"
export SETUP_REGISTRY_PORT="5050"

dotenv_if_exists .env
PATH_add bin